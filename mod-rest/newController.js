let taskIndexControllerViews={},taskIndexControllerStyles=[],taskIndexControllerScripts=["/cordys/html5/demo/TaskManagement/pages/task/model/task-model.js","/cordys/html5/demo/TaskManagement/pages/task/controller/task-create-controller.js","/cordys/html5/demo/TaskManagement/pages/task/controller/task-controller.js","/cordys/html5/demo/TaskManagement/pages/task/controller/task-filter-controller.js","/cordys/html5/demo/TaskManagement/pages/report/controller/task-timeline-controller.js","/cordys/html5/demo/TaskManagement/pages/program/controller/program-create-controller.js","/cordys/html5/demo/TaskManagement/pages/program/controller/program-edit-controller.js","/cordys/html5/demo/TaskManagement/pages/program/controller/program-controller.js","/cordys/html5/demo/TaskManagement/pages/project/controller/project-create-controller.js","/cordys/html5/demo/TaskManagement/pages/project/controller/project-controller.js","/cordys/html5/demo/TaskManagement/pages/project/controller/project-edit-controller.js","/cordys/html5/demo/TaskManagement/pages/project/controller/project-selector-controller.js","/cordys/html5/demo/TaskManagement/pages/report/controller/report-controller.js"];var dependency=Dependency.getInstance();function taskIndexControllerOnload(){var e=System();let t=e.getLanguage();e.translatePage(t,"task","TaskManagement","task-nav-header"),e.showLoader(!1),clickOnFirstLinkNav("task-nav-header"),dependency.initializeDomObject(["publish"]),$("body").addClass(window.lang)}function freeTextSearch(){let e=$("#search-input").attr("search-in");window[e]()}function clickOnFirstLinkNav(e){let t=document.getElementById(e).getElementsByTagName("nav")[0];$(t).find("a:first").click()}function waitForActive(e,t){if(e.offsetTop>0){let e=document.getElementsByTagName(t)[0].getAttribute("output-draw-function");window[e]()}else window.requestAnimationFrame(function(){waitForActive(e,t)})}function reloadArchivedTask(){window.dom.publish("filter-task","archive-task"),$("#search-input").attr("search-in","drawArchivedTask"),$("#task-create").attr("task-success","reloadArchivedTask"),waitForActive(document.getElementById("task-archive").getElementsByClassName("task-data-table")[0],"task-archive")}function reloadInProgressTask(){window.dom.publish("filter-task","in-progress-task"),$("#search-input").attr("search-in","drawInProgressTask"),$("#task-create").attr("task-success","reloadInProgressTask"),waitForActive(document.getElementById("inprogress-task").getElementsByClassName("task-data-table")[0],"inprogress-task")}function reloadCompletedTask(){window.dom.publish("filter-task","completed-task"),$("#search-input").attr("search-in","drawCompletedTask"),$("#task-create").attr("task-success","reloadCompletedTask"),waitForActive(document.getElementById("completed-task").getElementsByClassName("task-data-table")[0],"completed-task")}function reloadCreatedByTask(){window.dom.publish("filter-task","created-by-task"),$("#search-input").attr("search-in","drawCreatedByTask"),$("#task-create").attr("task-success","reloadCreatedByTask"),waitForActive(document.getElementById("task-created-by").getElementsByClassName("task-data-table")[0],"task-created-by")}function reloadMyOwnedTask(){window.dom.publish("filter-task","my-owned-task"),$("#search-input").attr("search-in","drawMyOwnedTask"),$("#task-create").attr("task-success","reloadMyOwnedTask"),waitForActive(document.getElementById("owned-task").getElementsByClassName("task-data-table")[0],"owned-task")}function reloadStoppedProgram(){$("#search-input").attr("search-in","drawStoppedProgram"),window.dom.publish("filter-task","stopped-program"),$("#program-create").attr("program-success","reloadStoppedProgram"),waitForActive(document.getElementById("stopped-program").getElementsByClassName("program-data")[0],"stopped-program")}function reloadEndedProgram(){$("#search-input").attr("search-in","drawEndedProgram"),window.dom.publish("filter-task","ended-program"),$("#program-create").attr("program-success","reloadEndedProgram"),waitForActive(document.getElementById("ended-program").getElementsByClassName("program-data")[0],"ended-program")}function reloadInProgressProgram(){$("#search-input").attr("search-in","drawInProgressProgram"),window.dom.publish("filter-task","inprogress-program"),$("#program-create").attr("program-success","reloadInProgressProgram"),waitForActive(document.getElementById("inprogress-program").getElementsByClassName("program-data")[0],"inprogress-program")}function reloadInProgressProject(){$("#search-input").attr("search-in","drawInProgressProjects"),window.dom.publish("filter-task","inprogress-project"),$("#project-create").attr("project-success","reloadInProgressProject"),waitForActive(document.getElementById("inprogress-project").getElementsByClassName("project-data-table")[0],"inprogress-project")}function reloadStoppedProject(){$("#search-input").attr("search-in","drawStoppedProjects"),window.dom.publish("filter-task","stopped-project"),$("#project-create").attr("project-success","reloadStoppedProject"),waitForActive(document.getElementById("stopped-project").getElementsByClassName("project-data-table")[0],"stopped-project")}function reloadEndedProject(){$("#search-input").attr("search-in","drawEndedProjects"),window.dom.publish("filter-task","ended-project"),$("#project-create").attr("project-success","reloadEndedProject"),waitForActive(document.getElementById("ended-project").getElementsByClassName("project-data-table")[0],"ended-project")}function changeParentNavCurrent(e,t,a,r){r=r||1;var s=e.parentElement.getElementsByClassName("current-tab");s.length>0&&s[0].classList.remove("current-tab"),e.classList.add("current-tab");var o=document.getElementById("program-create-button");o.setAttribute("data-target",t),o.parentElement.getElementsByTagName("span")[1].innerHTML=System().translateWord(a),o.parentElement.parentElement.style.display="inline-block";var n=e.getAttribute("href");clickOnFirstLinkNav(n=n.replace("#",""))}function changeChildNavCurrent(e){var t=e.parentElement.getElementsByClassName("current-tab");t.length>0&&t[0].classList.remove("current-tab"),e.classList.add("current-tab")}dependency.execute("taskIndexController");function TaskModel(e){if(e){let a={},s=TaskModel();for(var t=0;t<e.length;t++)a[e[t]]=s[e[t]];return a}return{createTask:function(e){return{url:Cordys().getSoapURL(),message:s(e)}},editTask:function(e){return{url:Cordys().getSoapURL(),message:a(e)}},getMyInProgressTask:function(e,t,a,s,r,o,n,d,m){n=n||new Date("October 15, 1920 05:35:32").toISOString().split("T")[0],d=d||new Date("October 15, 2120 05:35:32").toISOString().split("T")[0],o=o||-1,m=m||-1,r=r||"";let c={method:"MOD_TM_SP_task_GetMyInProgressTask",namespace:"http://schemas.cordys.com/MOD_TM_SP_task_GetMyInProgressTask",param:{PageNumber:e,PageSize:t,Owner:window.user.details.UserEntityId,sortBy:a,sortDir:s,TaskName:r,Progress:o,startDate:n,endDate:d,filterOwner:m,RETURN_VALUE:"PARAMETER"}};return Cordys().cordysAjax(c.method,c.namespace,c.param)},getCompletedTask:function(e,t,a,s,r,o,n,d,m){let c={method:"MOD_TM_SP_task_GetMyCompletedTask",namespace:"http://schemas.cordys.com/MOD_TM_SP_task_GetMyCompletedTask",param:{PageNumber:e,PageSize:t,userId:window.user.details.UserEntityId,sortBy:a,sortDir:s,TaskName:r,Progress:o,startDate:n,endDate:d,filterOwner:m,RETURN_VALUE:"PARAMETER"}};return Cordys().cordysAjax(c.method,c.namespace,c.param)},startTask:function(e){let t={method:"MOD_TM_BP_start_task",namespace:"http://schemas.cordys.com/default",param:{id:e}};return Cordys().cordysAjax(t.method,t.namespace,t.param)},getSubUsers:function(e,t,a,s){let r={method:"MOD_TM_SP_task_get_subusers_of_user",namespace:"http://schemas.cordys.com/MOD_TM_SP_task_get_subusers_of_user",param:{userId:e,input:t,RETURN_VALUE:"PARAMETER",PageNumber:a,PageSize:s}};return Cordys().cordysAjax(r.method,r.namespace,r.param)},getSubUsersRolesAndUnits:function(e,t,a,s){let r={method:"MOD_TM_SP_task_get_subUsersRolesUnits_of_user",namespace:"http://schemas.cordys.com/MOD_TM_SP_task_get_subUsersRolesUnits_of_user",param:{userId:e,input:t,RETURN_VALUE:"PARAMETER",PageNumber:a,PageSize:s}};return Cordys().cordysAjax(r.method,r.namespace,r.param)},getListOfWorkingUser:function(e,t,a){let s={method:"MOD_TM_webservice_TaskPerformer_GetListOfWorkingUser",namespace:"http://schemas/MyCompanyTaskManagement/MOD_TM_entity_TaskPerformer/operations",param:{taskId:e,Cursor:{"@offset":t-1,"@limit":a}}};return Cordys().cordysAjax(s.method,s.namespace,s.param)},endTask:function(e){let t={method:"MOD_TM_BP_endTask",namespace:"http://schemas.cordys.com/default",param:{targetTaskPerformerId:e}};return Cordys().cordysAjax(t.method,t.namespace,t.param)},getMyOwnedTask:function(e,t,a,s,r,o,n,d){let m={method:"MOD_TM_SP_task_GetMyOwnedTask",namespace:"http://schemas.cordys.com/MOD_TM_SP_task_GetMyOwnedTask",param:{Owner:window.user.details.UserEntityId,PageNumber:e,PageSize:t,sortBy:a,sortDir:s,TaskName:r,Progress:o,startDate:n,endDate:d,RETURN_VALUE:"PARAMETER"}};return Cordys().cordysAjax(m.method,m.namespace,m.param)},getCountTask:function(e,t,a,s,r,o){let n=a?-1==a?100:a:100,d=a?-1==a?0:a:0,m=o?-1==o?2147483646:o:2147483646,c=o?-1==o?0:o:0;t=t||"",s=s||new Date("October 15, 1920 05:35:32").toISOString().split("T")[0],r=r||new Date("October 15, 2120 05:35:32").toISOString().split("T")[0];let i={method:"MOD_TM_BP_count_task",namespace:"http://schemas.cordys.com/default",param:{owner:window.user.details.UserEntityId,type:e,taskName:t,progressS:d,progressL:n,startDate:s,endDate:r,filterOwnerS:c,filterOwnerL:m}};return Cordys().cordysAjax(i.method,i.namespace,i.param)},getCreatedByTask:function(e,t,a,s,r,o,n,d,m){let c={method:"MOD_TM_SP_task_GetMyCreatedTask",namespace:"http://schemas.cordys.com/MOD_TM_SP_task_GetMyCreatedTask",param:{Owner:window.user.details.UserEntityId,PageNumber:e,PageSize:t,sortBy:a,sortDir:s,TaskName:r,Progress:o,startDate:n,endDate:d,filterOwner:m,RETURN_VALUE:"PARAMETER"}};return Cordys().cordysAjax(c.method,c.namespace,c.param)},getDraftTask:function(e,t,a,s,r,o,n,d,m){let c={method:"MOD_TM_SP_task_GetDraftTask",namespace:"http://schemas.cordys.com/MOD_TM_SP_task_GetDraftTask",param:{userId:window.user.details.UserEntityId,PageNumber:e,PageSize:t,sortBy:a,sortDir:s,TaskName:r,Progress:o,startDate:n,endDate:d,filterOwner:m,RETURN_VALUE:"PARAMETER"}};return Cordys().cordysAjax(c.method,c.namespace,c.param)},getTaskById:function(e){let t={method:"ReadMOD_TM_entity_Task",namespace:"http://schemas/MyCompanyTaskManagement/MOD_TM_entity_Task/operations",param:{"MOD_TM_entity_Task-id":{Id:e}}};return Cordys().cordysAjax(t.method,t.namespace,t.param)},getTaskDataById:function(e){let t={method:"MOD_TM_SP_task_GetTaskDataById",namespace:"http://schemas.cordys.com/MOD_TM_SP_task_GetTaskDataById",param:{RETURN_VALUE:"PARAMETER",taskId:e}};return Cordys().cordysAjax(t.method,t.namespace,t.param)},updateTargetTaskPerformerProgress:function(e,t){let a={method:"UpdateMOD_TM_entity_TargetTaskPerformer",namespace:"http://schemas/MyCompanyTaskManagement/MOD_TM_entity_TargetTaskPerformer/operations",param:{"MOD_TM_entity_TargetTaskPerformer-id":{Id:e},"MOD_TM_entity_TargetTaskPerformer-update":{progress:t}}};return Cordys().cordysAjax(a.method,a.namespace,a.param)},getTargetTaskPerformerDetails:function(e,t){let a={method:"MOD_TM_SP_task_GetTargetTaskPerformerDetails",namespace:"http://schemas.cordys.com/MOD_TM_SP_task_GetTargetTaskPerformerDetails",param:{RETURN_VALUE:"PARAMETER",TaskId:e,UserId:t}};return Cordys().cordysAjax(a.method,a.namespace,a.param)},getCreatedTaskByEntityItemId:function(e,t,a,s,r,o){let n={method:"MOD_TM_SP_task_GetCreatedTaskByEntityItemId",namespace:"http://schemas.cordys.com/MOD_TM_SP_task_GetCreatedTaskByEntityItemId",param:{Owner:e,entityItemId:t,PageNumber:a,PageSize:s,sortBy:r,sortDir:o,RETURN_VALUE:"PARAMETER"}};return Cordys().cordysAjax(n.method,n.namespace,n.param)},deletePerformers:function(e,t){let a={method:"MOD_TM_BP_delete_performers",namespace:"http://schemas.cordys.com/default",param:{performerId:e,taskId:t}};return Cordys().cordysAjax(a.method,a.namespace,a.param)},deleteTask:function(e){let t={method:"MOD_TM_BP_DeleteTaskLogical",namespace:"http://schemas.cordys.com/default",param:{taskId:e}};return Cordys().cordysAjax(t.method,t.namespace,t.param)},getPerformerDetailsByTaskId:function(e,t){let a={method:"MOD_TM_webservice_TargetTaskPerformer_GetPerformerDetailsByTaskId",namespace:"http://schemas/MyCompanyTaskManagement/MOD_TM_entity_TargetTaskPerformer/operations",param:{taskId:t,performerId:e}};return Cordys().cordysAjax(a.method,a.namespace,a.param)},restartTask:function(e,t){let a={method:"MOD_TM_BP_restart_task",namespace:"http://schemas.cordys.com/default",param:{taskId:e,performerId:t}};return Cordys().cordysAjax(a.method,a.namespace,a.param)},getTotalTaskProgress:function(e){let t={method:"MOD_TM_SP_task_GetTotalTaskProgress",namespace:"http://schemas.cordys.com/MOD_TM_SP_task_GetTotalTaskProgress",param:{taskId:e,RETURN_VALUE:"PARAMETER"}};return Cordys().cordysAjax(t.method,t.namespace,t.param)},closeTask:function(e){let t={method:"MOD_TM_BP_closeTask",namespace:"http://schemas.cordys.com/default",param:{taskId:e}};return Cordys().cordysAjax(t.method,t.namespace,t.param)},updateProgress:function(e,t){let a={method:"MOD_TM_BP_UpdateUserProgress",namespace:"http://schemas.cordys.com/default",param:{targetPerformerEntityId:e,progress:t}};return Cordys().cordysAjax(a.method,a.namespace,a.param)},updateTaskWithProject:function(e,t){let a={method:"UpdateMOD_TM_entity_Task",namespace:"http://schemas/MyCompanyTaskManagement/MOD_TM_entity_Task/operations",param:{"MOD_TM_entity_Task-id":{Id:e},"MOD_TM_entity_Task-update":{taskProjectId:t}}};return Cordys().cordysAjax(a.method,a.namespace,a.param)},getOwners:function(e,t,a,s,r){s=s||1,r=r||assetConfig.autocompleteSize;let o=window.user.details.HeadUnit;window.user.details.UnitId,o||(o=window.user.details.UserUnitCode);"MSM"!=o&&"USM"!=o&&"AAM"!=o||(o="all");let n={method:"MOD_SYS_GENERAL_SP_GetUsersUnderHeadUnitCode",namespace:"http://schemas.cordys.com/MOD_SYS_GENERAL_SP_GetUsersUnderHeadUnitCode",param:{headunit:o,input:e,RETURN_VALUE:"PARAMETER",PageNumber:s,unitId:-1,PageSize:r}};return Cordys().cordysAjax(n.method,n.namespace,n.param)},getArchivedTask:function(e,t,a,s,r,o,n,d,m){e=e||1,t=t||assetConfig.pageSize,a=a||"endDate",s=s||"sortAsc",r=r||"",o=o||-1,n=n.split("T")[0]||new Date("October 15, 1920 05:35:32").toISOString().split("T")[0],d=d.split("T")[0]||new Date("October 15, 2120 05:35:32").toISOString().split("T")[0],m=m||-1;let c={method:"MOD_TM_SP_task_GetArchivedTask",namespace:"http://schemas.cordys.com/MOD_TM_SP_task_GetArchivedTask",param:{UserId:window.user.details.UserEntityId,PageNumber:e,PageSize:t,sortBy:"progress",sortDir:s,TaskName:r,Progress:o,startDate:n,endDate:d,filterOwner:m,RETURN_VALUE:"PARAMETER"}};return Cordys().cordysAjax(c.method,c.namespace,c.param)},archiveTask:function(e){let t={method:"UpdateMOD_TM_entity_Task",namespace:"http://schemas/MyCompanyTaskManagement/MOD_TM_entity_Task/operations",param:{"MOD_TM_entity_Task-id":{Id:e},"MOD_TM_entity_Task-update":{status:12}}};return Cordys().cordysAjax(t.method,t.namespace,t.param)},forceCloseTask:function(e){let t={method:"MOD_TM_BP_ForceCloseTask",namespace:"http://schemas.cordys.com/default",param:{ownerId:window.user.details.UserEntityId,taskId:e}};return Cordys().cordysAjax(t.method,t.namespace,t.param)},getCreatedTaskMeeting:function(e,t,a,s,r,o,n){let d={method:"MOD_TM_SP_task_GetCreatedTaskMeeting",namespace:"http://schemas.cordys.com/MOD_TM_SP_task_GetCreatedTaskMeeting",param:{Owner:e,entityItemId:t,type:a,PageNumber:s,PageSize:r,sortBy:o,sortDir:n,RETURN_VALUE:"PARAMETER"}};return Cordys().cordysAjax(d.method,d.namespace,d.param)},getTaskHistoryByTaskId:function(e){let t={method:"MOD_TM_SP_GetTaskHistoryByTaskId",namespace:"http://schemas.cordys.com/MOD_TM_SP_GetTaskHistoryByTaskId",param:{RETURN_VALUE:"PARAMETER",TaskId:e}};return Cordys().cordysAjax(t.method,t.namespace,t.param)},performerReturnTask:function(e,t){let a={method:"MOD_TM_BP_PerformerReturnTask",namespace:"http://schemas.cordys.com/default",param:{taskId:e,targetTaskEntityId:t}};return Cordys().cordysAjax(a.method,a.namespace,a.param)}};function a(e){let t=e.singleOrMultiple()instanceof Array?e.singleOrMultiple()[0]:e.singleOrMultiple()?e.singleOrMultiple():1,a=e.taskProject()instanceof Array?e.taskProject()[0]:e.taskProject()?e.taskProject():"";return-1!=a.indexOf(":")&&(a=a.split(":")[0]),""==a&&(a=0),'<SOAP:Envelope xmlns:SOAP="http://schemas.xmlsoap.org/soap/envelope/"><SOAP:Body><MOD_TM_BP_edit_task xmlns="http://schemas.cordys.com/default"><name>'+e.taskName()+"</name><description>"+e.taskDescription()+"</description><startDate>"+new Date(e.taskStartDate()).toISOString().replace(".000Z","")+"</startDate><endDate>"+new Date(e.taskEndDate()).toISOString().replace(".000Z","")+"</endDate><owner>"+e.taskOwner()+"</owner><users>"+e.taskUsers()+"</users><entityItemId>"+e.taskEntityItemId()+"</entityItemId><pirority>"+e.taskPriority()[0]+"</pirority><source>"+e.taskSource()+"</source><taskData>"+e.taskData()+"</taskData><createdBy>"+window.user.details.UserEntityId+"</createdBy><status>"+e.status()+"</status><taskProjectId>"+a+"</taskProjectId><controllerName>"+e.controllerName()+"</controllerName><applicationName>"+e.applicationName()+"</applicationName><entityName>"+e.entityName()+"</entityName><tId>"+e.taskId()+"</tId><editUserId>"+window.user.details.UserEntityId+"</editUserId><singleOrMultiple>"+t+"</singleOrMultiple><oldUsers>"+e.deletedUser()+"</oldUsers></MOD_TM_BP_edit_task></SOAP:Body></SOAP:Envelope>"}function s(e){let t="";e.taskProject&&(t=e.taskProject()instanceof Array?e.taskProject()[0]:e.taskProject()?e.taskProject():""),-1!=t.indexOf(":")&&(t=t.split(":")[0]);let a=e.singleOrMultiple()instanceof Array?e.singleOrMultiple()[0]:e.singleOrMultiple(),s="",r="";return e.taskStartDate()&&(s="<startDate>"+new Date(e.taskStartDate()).toISOString().replace(".000Z","")+"</startDate>"),e.taskEndDate()&&(r="<endDate>"+new Date(e.taskEndDate()).toISOString().replace(".000Z","")+"</endDate>"),'<SOAP:Envelope xmlns:SOAP="http://schemas.xmlsoap.org/soap/envelope/"><SOAP:Body><MOD_TM_BP_create_task xmlns="http://schemas.cordys.com/default"><name>'+e.taskName()+"</name><description>"+e.taskDescription()+"</description>"+s+r+"<owner>"+e.taskOwner()+"</owner><users>"+e.taskUsers()+"</users><pirority>"+e.taskPriority()[0]+"</pirority><source>"+e.taskSource()+"</source><taskData>"+e.taskData()+"</taskData><entityItemId>"+e.taskEntityItemId()+"</entityItemId><createdBy>"+window.user.details.UserEntityId+"</createdBy><controllerName>"+e.controllerName()+"</controllerName><applicationName>"+e.applicationName()+"</applicationName><entityName>"+e.entityName()+"</entityName><status>"+e.status()+"</status><projectId>"+t+"</projectId><singleOrMultiple>"+a+"</singleOrMultiple><entityBWSId>"+e.entityBWSId()+"</entityBWSId></MOD_TM_BP_create_task></SOAP:Body></SOAP:Envelope>"}}const taskCreateControllerViews={"task-create":"/cordys/html5/demo/TaskManagement/pages/task/views/task-create.html"},taskCreateControllerStyles=["/cordys/html5/demo/TaskManagement/pages/task/resources/styles/style.css"],taskCreateControllerScripts=["/cordys/html5/demo/TaskManagement/pages/task/services/task-service.js","/cordys/html5/demo/TaskManagement/pages/project/service/project-service.js","/cordys/html5/demo/TaskManagement/pages/task/model/task-model.js","/cordys/html5/demo/TaskManagement/pages/project/model/project-model.js","/cordys/html5/demo/commons/javascripts/ui/selectize.js","/cordys/html5/demo/commons/services/lookup-service.js"];var dependency=Dependency.getInstance();dependency.addToTrigger("taskCreateControllerOnReady"),dependency.execute("taskCreateController");let taskModelView=null;function taskCreateControllerOnload(){dependency.initializeSystemObject(["handleError","translatePage","extendSelectize","showLoader","translateWord","showMessage","removeNullAndUndefined","decrypt","getMinDate","getUrlVariable","encrypt","generateNumber"]),dependency.initializeDomObject(["subscribe","publish"]),window.system.translatePage(window.lang,"task","TaskManagement","task-create"),window.system.extendSelectize(),taskModelView=new taskObject,KOValidation().initializeValidation(taskModelView),ko.applyBindings(taskModelView,$("#task-create")[0]),window.dom.subscribe("edit-task",function(e){bindEditTask(e)}),window.dom.subscribe("set-max-date",function(e){taskModelView.maxDate(e)}),window.dom.subscribe("set-min-date",function(e){taskModelView.minDate(e)}),window.dom.subscribe("have-point-of-discussion",function(e){taskModelView.havePointOfDiscussion(e)})}function taskCreateControllerOnReady(){$("#task-create").on("shown.bs.modal",function(){restTask()}),$("#task-owner-selectize input").on("input",function(){autocompleteTaskOwnerOptions(this.value)}),taskModelView.autoCompleteTeamMembersFunc=TaskService().autocompleteTaskTeamOptions,$("#task-create").attr("task-performers")&&(taskModelView.autoCompleteTeamMembersFunc=window[$("#task-create").attr("task-performers")]),$("#task-team input").on("input",function(){taskModelView.autoCompleteTeamMembersFunc(taskModelView,this.value)}),$("#task-project input").on("input",function(){TaskService().autocompleteProjectOptions(taskModelView.taskProjectOptions,this.value)}),addTaskCurrentUserToBeOwner([]),taskModelView.autoCompleteTeamMembersFunc(taskModelView,""),TaskService().autocompleteProjectOptions(taskModelView.taskProjectOptions,""),autocompletePirorityOptions()}function autocompleteTaskOwnerOptions(e){TaskModel().getOwners(e).done(function(t){let s=[];if(t.tuple[0]){var a=t.tuple[0].old.rowset.row;if(a instanceof Array)for(let e=0;e<a.length;e++)s.push({id:a[e].UserEntityId,name:a[e].DisplayName});else s.push({id:a.UserEntityId,name:a.DisplayName});taskModelView.taskOwnerOptions(s),""==e&&addTaskCurrentUserToBeOwner(s)}})}function addTaskCurrentUserToBeOwner(e){e.push({id:window.user.details.UserEntityId,name:window.user.details.DisplayName}),taskModelView.taskOwnerOptions(e),taskModelView.taskOwner([window.user.details.UserEntityId])}function isSelectedBefore(e,t){let s=document.getElementById("suppliers-name-list").getElementsByTagName("li");for(var a=0;a<s.length;a++){if(e==window.system.decrypt(s[a].id)+":"+s[a].getAttribute("type"))return window.system.showMessage("warn",window.system.translateWord("isSelectedBefore")+" "+t),!0}return!1}function initializeEmptyData(){taskModelView.taskOwner()||taskModelView.taskOwner(window.user.details.UserEntityId),taskModelView.taskSource()||taskModelView.taskSource($("#task-create").attr("task-source")),taskModelView.taskData()||taskModelView.taskData($("#task-create").attr("task-data")),taskModelView.taskEntityItemId()||taskModelView.taskEntityItemId($("#task-create").attr("task-entity-itemId")),taskModelView.controllerName()||taskModelView.controllerName($("#task-create").attr("controller-name")),taskModelView.applicationName()||taskModelView.applicationName($("#task-create").attr("application-name")),taskModelView.entityName()||taskModelView.entityName($("#task-create").attr("entity-name")),taskModelView.havePointOfDiscussion()&&taskModelView.taskData("post-"+taskModelView.pointOfDiscussion())}function createSuccess(e){"create"==e&&window.dom.publish("task-create-success",!0),"edit"==e&&window.dom.publish("task-edit-success",!0),$("#mod-btn-task-close").click(),window.system.showLoader(!1);var t=$("#task-create").attr("task-success");t&&t.length>3&&window[t](),window.system.showMessage("success",window.system.translateWord(taskModelView.successMessage())),window.dom.publish("reload-report",!0)}function bindEditTask(e){taskModelView.isEdit(!0);var t=null;t=e,$("#task-create").modal("toggle"),taskModelView.headerTitle(window.system.translateWord("edit-task"));let s=[];if(e instanceof Array){t=e[0];for(let t=0;t<e.length;t++)s.push(e[t].performerId+":"+e[t].type+":"+e[t].performerName)}else e.performerId&&(s=[e.performerId+":"+e.type+":"+e.performerName]);if(taskModelView.oldUsers(s),taskModelView.taskTeamOptions(s),taskModelView.taskTeam(s),t=window.system.removeNullAndUndefined(t),taskModelView.taskId(t.Id),taskModelView.taskPage(!0),taskModelView.taskName(t.taskName),taskModelView.taskEndDate(t.dueDate.split("T")[0]),taskModelView.taskStartDate(t.startDate.split("T")[0]),taskModelView.taskDescription(t.description),taskModelView.taskSource(t.source),taskModelView.controllerName(t.controllerName),taskModelView.taskEntityItemId(t.entityItemId),taskModelView.entityName(t.entityName),taskModelView.applicationName(t.applicationName),0==t.taskData.indexOf("post-")){taskModelView.havePointOfDiscussion(!0);let e=t.taskData.substring(5,t.taskData.length);taskModelView.pointOfDiscussion(e)}else taskModelView.havePointOfDiscussion(!1);taskModelView.taskData(t.taskData),taskModelView.status(t.status),2==parseInt(t.status)&&(taskModelView.editable("dimmed"),taskModelView.minDate(taskModelView.taskEndDate()));let a="false"==t.singleOrMultiple?0:1;taskModelView.singleOrMultiple([a]),t.taskProjectId&&(taskModelView.taskProjectOptions([{id:t.taskProjectId,name:t.taskProjectName}]),taskModelView.taskProject([t.taskProjectId])),taskModelView.taskOwnerOptions([{id:t.ownerId,name:t.owner}]),taskModelView.taskOwner([t.ownerId]),autocompletePirorityOptions(t.priority),taskModelView.autoCompleteTeamMembersFunc(taskModelView,"")}function restTask(){if(taskModelView.editable(""),taskModelView.isEdit())taskModelView.isEdit(!1),$("#mod-btn-task-submit").html(window.system.translateWord("edit")),$("#mod-btn-task-submit").attr("translate-text","edit"),taskModelView.successMessage("editTaskSuccess"),taskModelView.editableTaskType("dimmed");else{let e=TaskService();taskModelView.editableTaskType(""),taskModelView.taskPriority([]),autocompletePirorityOptions(),autocompleteTaskOwnerOptions(""),taskModelView.autoCompleteTeamMembersFunc(taskModelView,""),e.autocompleteProjectOptions(taskModelView.taskProjectOptions,""),taskModelView.taskId(null),$("#mod-btn-task-submit").html(window.system.translateWord("add")),$("#mod-btn-task-submit").attr("translate-text","add")}taskModelView.deletedUser(null),taskModelView.taskPage(!0),taskModelView.taskName(null),taskModelView.taskEndDate(""),taskModelView.taskStartDate(""),taskModelView.taskDescription(null),taskModelView.pointOfDiscussion(null),taskModelView.taskSource(null),taskModelView.taskData(null),taskModelView.taskEntityItemId(null),taskModelView.status(null),taskModelView.singleOrMultiple(),taskModelView.taskTeamOptions([]),taskModelView.taskTeam([]),taskModelView.taskUsers(null),taskModelView.minDate(window.system.getMinDate()),taskModelView&&taskModelView.errors&&taskModelView.errors.showAllMessages(!1),window.system.showLoader(!1)}function autocompletePirorityOptions(e){LookupService().getByCategory("priority").done(function(t){t=t.MOD_SYS_entity_lookup?t.MOD_SYS_entity_lookup:t;var s=[];for(let e in t)if("object"==typeof t[e]){var a=t[e],o="ar"==window.lang?a.ar_value:a.eng_value;s.push({id:a.key,name:o})}taskModelView.taskPriorityOptions(s),e&&taskModelView.taskPriority([e])}).fail(function(e){window.system.handleError(e),console.log(e.responseJSON.faultstring.text)})}function taskObject(){var e=this;e.hasError=ko.observable(!0),e.autoCompleteTeamMembersFunc=null,e.editable=ko.observable(""),e.editableTaskType=ko.observable(""),e.headerTitle=ko.observable(window.system.translateWord("add-task")),e.havePointOfDiscussion=ko.observable(!1),e.pointOfDiscussion=ko.observable().extend({required:{message:window.system.translateWord("requiredField"),onlyIf:function(){return e.havePointOfDiscussion()}}});let t=Cordys().getTaskId();e.showSave=ko.observable(!0),t?e.showSave(!1):e.showSave(!0),e.successMessage=ko.observable("createTaskSuccess"),e.taskName=ko.observable().extend({required:{params:!0,message:window.system.translateWord("requiredField")},maxLength:{params:200,message:window.system.translateWord("maxLength200")},modletter:{params:!0,message:window.system.translateWord("specialCharNotAllowed")}}),e.minDate=ko.observable(window.system.getMinDate()),e.maxDate=ko.observable(new Date("October 15, 2120 05:35:32").toISOString().split("T")[0]),e.todayDate=ko.observable(window.system.getMinDate()),e.taskEndDate=ko.observable().extend({required:{params:!0,message:window.system.translateWord("requiredField")},date:{params:!0,message:window.system.translateWord("requiredDate")},biggerThanDate:{params:e.taskStartDate,message:window.system.translateWord("biggerThanDate")}}),e.taskStartDate=ko.observable().extend({required:{params:!0,message:window.system.translateWord("requiredField")},date:{params:!0,message:window.system.translateWord("requiredDate")},smallerThanDate:{params:e.taskEndDate,message:window.system.translateWord("smallerThanDate")}}),e.taskStartDate.subscribe(function(t){t.length<2||e.minDate(t)}),e.taskPriorityOptions=ko.observableArray(),e.taskPriority=ko.observable().extend({required:{params:!0,message:window.system.translateWord("requiredField")}}),e.taskDescription=ko.observable().extend({maxLength:{params:4e3,message:window.system.translateWord("maxLength4000")},modletter:{params:!0,message:window.system.translateWord("specialCharNotAllowed")}}),e.taskProjectOptions=ko.observableArray(),e.taskProject=ko.observable(),e.taskProject.subscribe(function(e){let t=e instanceof Array?e[0]:e||"";-1!=t.indexOf(":")&&(t=t.split(":")[1].split("T")[0],window.dom.publish("set-max-date",t))}),e.singleOrMultiple=ko.observable(),e.singleOrMultipleOptions=ko.observableArray([{id:0,name:window.system.translateWord("single-user")},{id:1,name:window.system.translateWord("multiple-user")}]),e.taskSource=ko.observable(),e.taskData=ko.observable(),e.taskEntityItemId=ko.observable(),e.status=ko.observable(),e.taskOwnerOptions=ko.observableArray(),e.taskOwner=ko.observable(),e.controllerName=ko.observable(""),e.applicationName=ko.observable(""),e.entityName=ko.observable(""),e.taskTeamOptions=ko.observableArray(),e.taskTeam=ko.observableArray(),e.entityBWSId=ko.observable(window.system.generateNumber()),e.taskTeam.subscribe(function(t){e.taskUsers([]);for(var s="",a=0;a<t.length;a++){let o=t[a].split(":");o[0]!=taskModelView.taskOwner()?("Role"==o[1]?o[1]=1:"User"==o[1]?o[1]=0:"Unit"==o[1]?o[1]=2:o[1]=o[1],s+="<user>",s+="<type>"+o[1]+"</type>",s+="<id>"+o[0]+"</id>",s+="<displayName>"+o[2]+"</displayName>",s+="</user>"):(window.system.showMessage("warn",o[2]+" "+window.system.translateWord("taskPerformerIsTaskOwner")),e.taskTeam().splice(e.taskTeam().length-1,1),e.taskTeam(e.taskTeam()))}e.taskUsers(s)}),e.taskUsers=ko.observable().extend({required:!0}),e.oldUsers=ko.observable(),e.isEdit=ko.observable(!1),e.taskId=ko.observable(),e.taskPage=ko.observable(!0),e.deletedUser=ko.observable(),e.saveTask=function(){e.taskName()?(e.status(10),initializeEmptyData(),e.taskId()?TaskService().editTask(e,createSuccess,window.system.handleError):TaskService().createTask(e,createSuccess,window.system.handleError)):KOValidation().showMessage("task-name",window.system.translateWord("requiredField"))},e.submit=function(){if(e.entityBWSId(window.system.generateNumber()),!(e.errors().length>0))if(window.system.showLoader(!0),initializeEmptyData(),e.taskId()){10==parseInt(e.status())&&e.status(1),console.log(e.oldUsers()),console.log(e.taskTeam());let a=e.oldUsers(),o=e.taskTeam();for(var t="",s=0;s<a.length;s++){let e=a[s].split(":");-1==o.indexOf(a[s])&&(console.log(a[s]+" is deleted"),"Role"==e[1]?e[1]=1:"User"==e[1]?e[1]=0:"Unit"==e[1]?e[1]=2:e[1]=0,t+="<user>",t+="<type>"+e[1]+"</type>",t+="<id>"+e[0]+"</id>",t+="</user>")}e.deletedUser(t),TaskService().editTask(e,createSuccess,window.system.handleError)}else e.status(1),TaskService().createTask(e,createSuccess,window.system.handleError)},e.close=function(){},e.errors=ko.validation.group(e)}const taskControllerViews={"inprogress-task":"/cordys/html5/demo/TaskManagement/pages/task/views/task-table.html","task-created-by":"/cordys/html5/demo/TaskManagement/pages/task/views/task-table.html","completed-task":"/cordys/html5/demo/TaskManagement/pages/task/views/task-table.html","owned-task":"/cordys/html5/demo/TaskManagement/pages/task/views/task-table.html","task-archive":"/cordys/html5/demo/TaskManagement/pages/task/views/task-table.html"},taskControllerStyles=[],taskControllerScripts=["/cordys/html5/demo/TaskManagement/pages/task/services/task-service.js","/cordys/html5/demo/TaskManagement/pages/task/model/task-model.js","/cordys/html5/demo/commons/javascripts/jquery.twbsPagination.js"];var dependency=Dependency.getInstance();dependency.execute("taskController");let taskControllerObject={taskInProgressViewModel:null,taskCreatedBy:null,taskCompleted:null,taskArchived:null,taskOwned:null,model:null,service:null,currentTab:1},filterObject={sortBy:"startDate",sortDir:"sortDesc",freeText:"",progress:-1,startDate:null,endDate:null,filterOwner:-1};function taskControllerOnload(){dependency.initializeSystemObject(["getLanguage","translatePage","showLoader","translateWord","showMessage","removeNullAndUndefined","encrypt"]),dependency.initializeDomObject(["sortable","subscribe","publish","drawPagination"]);let e=window.system.getLanguage();window.system.translatePage(e,"task-controller","TaskManagement","task-container");var t=document.getElementById("inprogress-task").getElementsByClassName("main-table")[0];window.dom.sortable(t,"fillMyInProgressTaskTable");var s=document.getElementById("task-created-by").getElementsByClassName("main-table")[0];window.dom.sortable(s,"fillCreatedByTable");var r=document.getElementById("owned-task").getElementsByClassName("main-table")[0];window.dom.sortable(r,"fillMyOwnedTable");var o=document.getElementById("completed-task").getElementsByClassName("main-table")[0];window.dom.sortable(o,"fillCompletedTask");var a=document.getElementById("task-archive").getElementsByClassName("main-table")[0];window.dom.sortable(a,"fillArchivedTask"),taskControllerObject.taskInProgressViewModel=new TaskViewModel,ko.applyBindings(taskControllerObject.taskInProgressViewModel,t),taskControllerObject.taskCreatedBy=new TaskViewModel,ko.applyBindings(taskControllerObject.taskCreatedBy,s),taskControllerObject.taskOwned=new TaskViewModel,ko.applyBindings(taskControllerObject.taskOwned,r),taskControllerObject.taskCompleted=new TaskViewModel,ko.applyBindings(taskControllerObject.taskCompleted,o),taskControllerObject.taskArchived=new TaskViewModel,ko.applyBindings(taskControllerObject.taskArchived,a),taskControllerObject.model=TaskModel(["getCountTask","closeTask","startTask","endTask","restartTask","deleteTask","getArchivedTask","archiveTask","forceCloseTask"]),taskControllerObject.service=TaskService(["getCreatedByTask","getMyOwnedTask","getInProgressTask","getCompletedTask","addAttributesToTaskResponse","viewTask","showEdit","openTaskCollapse"]),window.dom.subscribe("in-progress-task",function(e){drawInProgressTask(e.taskName(),e.progress(),e.startDate(),e.endDate(),e.owner())}),window.dom.subscribe("completed-task",function(e){drawCompletedTask(e.taskName(),e.progress(),e.startDate(),e.endDate(),e.owner())}),window.dom.subscribe("created-by-task",function(e){drawCreatedByTask(e.taskName(),e.progress(),e.startDate(),e.endDate(),e.owner())}),window.dom.subscribe("my-owned-task",function(e){drawMyOwnedTask(e.taskName(),e.progress(),e.startDate(),e.endDate())}),window.dom.subscribe("task-archive",function(e){drawArchivedTask(e.taskName(),e.progress(),e.startDate(),e.endDate(),e.owner())}),window.dom.subscribe("start-task",function(e){window.system.showLoader(!0,document.getElementById("inprogress-task")),taskControllerObject.model.startTask(e).done(function(){window.system.showLoader(!1),drawInProgressTask(),window.system.showMessage("success",window.system.translateWord("task-start-success"))}).fail(function(e){window.system.handleError(e)})})}function drawArchivedTask(e,t,s,r,o){setFilterObject(e,t,s,r,o),getCount("archive",document.getElementById("task-archive"),fillArchivedTask,filterObject.freeText,filterObject.progress,filterObject.startDate,filterObject.endDate,filterObject.filterOwner)}function fillArchivedTask(e,t,s){t&&(filterObject.sortBy=t),s&&(filterObject.sortDir=s);var r=document.getElementById("task-archive");window.system.showLoader(!0,r),taskControllerObject.model.getArchivedTask(e,assetConfig.pageSize,filterObject.sortBy,filterObject.sortDir,filterObject.freeText,filterObject.progress,filterObject.startDate,filterObject.endDate,filterObject.filterOwner).done(function(e){addResponseToModel(e,taskControllerObject.taskArchived)}).fail(function(e){window.system.handleError(e)})}function setFilterObject(e,t,s,r,o){filterObject.sortBy="startDate",filterObject.sortDir="sortDesc",filterObject.progress=t||-1,filterObject.filterOwner=o||-1,filterObject.freeText=e||($("#search-input").val()||""),filterObject.startDate=s||new Date("October 15, 1920").toISOString().split("T")[0],filterObject.endDate=r||new Date("October 15, 2120").toISOString().split("T")[0]}function fillCompletedTask(e,t,s){t&&(filterObject.sortBy=t),s&&(filterObject.sortDir=s);var r=document.getElementById("completed-task");window.system.showLoader(!0,r),taskControllerObject.service.getCompletedTask(filterObject.sortBy,filterObject.sortDir,e,null,filterObject.freeText,filterObject.progress,filterObject.startDate,filterObject.endDate,filterObject.filterOwner).done(function(e){addResponseToModel(e,taskControllerObject.taskCompleted,"completedTask")}).fail(function(e){window.system.handleError(e)})}function drawCompletedTask(e,t,s,r,o){setFilterObject(e,t,s,r,o),getCount("completed",document.getElementById("completed-task"),fillCompletedTask,filterObject.freeText,filterObject.progress,filterObject.startDate,filterObject.endDate,filterObject.filterOwner)}function drawCreatedByTask(e,t,s,r,o){setFilterObject(e,t,s,r,o),getCount("createdTask",document.getElementById("task-created-by"),fillCreatedByTable,filterObject.freeText,filterObject.progress,filterObject.startDate,filterObject.endDate,filterObject.filterOwner)}function fillCreatedByTable(e,t,s){t&&(filterObject.sortBy=t),s&&(filterObject.sortDir=s);var r=document.getElementById("task-created-by");window.system.showLoader(!0,r),taskControllerObject.service.getCreatedByTask(filterObject.sortBy,filterObject.sortDir,e,null,filterObject.freeText,filterObject.progress,filterObject.startDate,filterObject.endDate,filterObject.filterOwner).done(function(e){addResponseToModel(e,taskControllerObject.taskCreatedBy)}).fail(function(e){window.system.handleError(e)})}function drawMyOwnedTask(e,t,s,r){setFilterObject(e,t,s,r),getCount("ownedTask",document.getElementById("owned-task"),fillMyOwnedTable,filterObject.freeText,filterObject.progress,filterObject.startDate,filterObject.endDate)}function fillMyOwnedTable(e,t,s){t&&(filterObject.sortBy=t),s&&(filterObject.sortDir=s);var r=document.getElementById("owned-task");window.system.showLoader(!0,r),taskControllerObject.service.getMyOwnedTask(filterObject.sortBy,filterObject.sortDir,e,null,filterObject.freeText,filterObject.progress,filterObject.startDate,filterObject.endDate).done(function(e){addResponseToModel(e,taskControllerObject.taskOwned)}).fail(function(e){window.system.handleError(e)})}function drawInProgressTask(e,t,s,r,o){setFilterObject(e,t,s,r,o),getCount("inProgress",document.getElementById("inprogress-task"),fillMyInProgressTaskTable,filterObject.freeText,filterObject.progress,filterObject.startDate,filterObject.endDate,filterObject.filterOwner)}function fillMyInProgressTaskTable(e,t,s){t&&(filterObject.sortBy=t),s&&(filterObject.sortDir=s);var r=document.getElementById("inprogress-task");window.system.showLoader(!0,r),taskControllerObject.service.getInProgressTask(filterObject.sortBy,filterObject.sortDir,e,null,filterObject.freeText,filterObject.progress,filterObject.startDate,filterObject.endDate,filterObject.filterOwner).done(function(e){addResponseToModel(e,taskControllerObject.taskInProgressViewModel)}).fail(function(e){window.system.handleError(e)})}function getCount(e,t,s,r,o,a,n,l){taskControllerObject.taskInProgressViewModel.tasks([]),taskControllerObject.taskCreatedBy.tasks([]),taskControllerObject.taskCreatedBy.tasks([]),taskControllerObject.taskCompleted.tasks([]),taskControllerObject.taskOwned.tasks([]),taskControllerObject.taskArchived.tasks([]),taskControllerObject.model.getCountTask(e,r,o,a,n,l).done(function(e){window.system.showLoader(!1);var r=Math.ceil(e.count.text/assetConfig.pageSize);if(0!=r)window.dom.drawPagination(t.getElementsByClassName("pagination")[0],r,s),s();else{let e=t.getElementsByClassName("pagination")[0];$(e).twbsPagination&&$(e).removeData("twbs-pagination")}}).fail(function(e){window.system.handleError(e)})}function addResponseToModel(e,t,s){if(e.tuple[0]){if((e=e.tuple[0].old.rowset.row)instanceof Array)for(let t=0;t<e.length;t++)e[t].progress||(e[t].progress=0),e[t]=window.system.removeNullAndUndefined(e[t]),e[t]=taskControllerObject.service.addAttributesToTaskResponse(e[t],s),e[t]=addActionToResponse(e[t]),e[t].taskData=ko.observable();else e.progress||(e.progress=0),e=window.system.removeNullAndUndefined(e),(e=addActionToResponse(e=taskControllerObject.service.addAttributesToTaskResponse(e,s))).taskData=ko.observable();t.tasks(e),window.system.showLoader(!1)}else window.system.showLoader(!1)}function addActionToResponse(e){return e.performerReturnTask=function(e,t){TaskModel().performerReturnTask(e.Id,e.targetTaskPerformerId).done(function(e){let t=$("#task-create").attr("task-success");t&&t.length>2&&setTimeout(function(){window.system.showMessage("success","return-task-success"),window[t]()},1e3),window.dom.publish("reload-report",!0)}).fail(function(e){window.system.handleError(e)})},e.archiveTask=function(e,t){taskControllerObject.model.archiveTask(e.Id).done(function(e){let t=$("#task-create").attr("task-success");t&&t.length>2&&(window.system.showMessage("success",system.translateWord("archive-task-success")),setTimeout(function(){window[t]()},1e3)),window.dom.publish("reload-report",!0)}).fail(function(e){window.system.handleError(e)})},e.forceCloseTask=function(e,t){taskControllerObject.model.forceCloseTask(e.Id).done(function(e){let t=$("#task-create").attr("task-success");t&&t.length>2&&setTimeout(function(){window.system.showMessage("success",system.translateWord("close-task-success")),window[t]()},1e3),window.dom.publish("reload-report",!0)}).fail(function(e){window.system.handleError(e)})},e.displayTask=function(e,t){taskControllerObject.service.viewTask(window.system.encrypt(e.Id))},e.closeTask=function(e,t){taskControllerObject.model.closeTask(e.Id).done(function(){e.canArchive(!0),e.canClose(!1),e.canEdit(!1);let t=$("#task-create").attr("task-success");t&&t.length>2&&setTimeout(function(){window.system.showMessage("success",system.translateWord("close-task-success")),window[t]()},1e3),window.dom.publish("reload-report",!0)}).fail(function(e){window.system.handleError(e)})},e.editTask=function(e){taskControllerObject.service.showEdit(e.Id,function(e){window.dom.publish("edit-task",e)})},e.deleteTask=function(e){taskControllerObject.model.deleteTask(e.Id).done(function(e){var t=$("#task-create").attr("task-success");t&&t.length>3&&setTimeout(function(){window.system.showMessage("success",system.translateWord("delete-task-success")),window[t]()},1e3),window.dom.publish("reload-report",!0)}).fail(function(e){window.system.handleError(e)})},e.openTaskCollapse=function(e,t){taskControllerObject.service.openTaskCollapse(e.Id,t.target,function(t){e.taskPerformers(t)})},e.startTask=function(e,t){window.dom.publish("start",e)},e.endTask=function(e,t){window.system.showLoader(!0,document.getElementById("inprogress-task")),taskControllerObject.model.endTask(e.targetTaskPerformerId).done(function(){let e=$(t.target).closest("tr"),s=$(e).next("tr");$(e).remove(),$(s).remove(),window.system.showLoader(!1),window.system.showMessage("success",window.system.translateWord("task-end-success")),window.dom.publish("reload-report",!0)}).fail(function(e){window.system.handleError(e)})},e.restartTask=function(e,t){window.system.showLoader(!0,document.getElementById("inprogress-task")),taskControllerObject.model.restartTask(e.Id,e.targetTaskPerformerId).done(function(){system.showLoader(!1),drawInProgressTask(),window.dom.publish("reload-report",!0)}).fail(function(e){system.handleError(e)})},e}function TaskViewModel(){this.tasks=ko.observableArray([])}let dynamicFilterControllerViews={"task-filter":"/cordys/html5/demo/TaskManagement/pages/task/views/task-filter.html"},dynamicFilterControllerStyles=[],dynamicFilterControllerScripts=[];var dependency=Dependency.getInstance();dependency.addToTrigger("dynamicFilterControllerOnReady"),dependency.execute("dynamicFilterController");let dynamicFilterViewModel=null;function dynamicFilterControllerOnload(){dependency.initializeSystemObject(["getLanguage","translatePage","showMessage","translateWord","extendSelectize"]),dependency.initializeDomObject(["subscribe"]);let e=window.system.getLanguage();window.system.translatePage(e,"task","TaskManagement","task-filter"),window.system.extendSelectize(),dynamicFilterViewModel=new DynamicFilterViewModel,ko.applyBindings(dynamicFilterViewModel,$("#task-filter")[0]),window.dom.subscribe("filter-task",function(e){-1!=e.indexOf("task")?(dynamicFilterViewModel.headerLabel(window.system.translateWord("filter-task")),dynamicFilterViewModel.filterName(window.system.translateWord("task-name")),dynamicFilterViewModel.filterOwnerName(window.system.translateWord("task-owner"))):-1!=e.indexOf("program")?(dynamicFilterViewModel.headerLabel(window.system.translateWord("filter-program")),dynamicFilterViewModel.filterName(window.system.translateWord("program-name")),dynamicFilterViewModel.filterOwnerName(window.system.translateWord("program-owner"))):-1!=e.indexOf("project")&&(dynamicFilterViewModel.headerLabel(window.system.translateWord("filter-project")),dynamicFilterViewModel.filterName(window.system.translateWord("project-name")),dynamicFilterViewModel.filterOwnerName(window.system.translateWord("project-owner"))),dynamicFilterViewModel.targetTab(e),"my-owned-task"==e?dynamicFilterViewModel.disableOwner(!1):dynamicFilterViewModel.disableOwner(!0)})}function autoCompleteOwner(e){TaskModel().getSubUsers(window.user.details.UserEntityId,e,1,3).done(function(e){let t=[];if(e.tuple[0]){var i=e.tuple[0].old.rowset.row;if(i instanceof Array)for(let e=0;e<i.length;e++)t.push({id:i[e].UserEntityId,name:i[e].DisplayName});else t.push({id:i.UserEntityId,name:i.DisplayName});dynamicFilterViewModel.ownerOptions(t)}})}function dynamicFilterControllerOnReady(){autoCompleteOwner(""),$("#task-filter").on("shown.bs.modal",function(){restDynamicFilter()}),$("#filter-owner input").on("input",function(){autoCompleteOwner(this.value)})}function restDynamicFilter(){dynamicFilterViewModel.taskName(""),dynamicFilterViewModel.startDate(""),dynamicFilterViewModel.endDate(""),dynamicFilterViewModel.owner(""),dynamicFilterViewModel.progress("")}function DynamicFilterViewModel(){let e=this;this.targetTab=ko.observable(),this.taskName=ko.observable(),this.startDate=ko.observable(),this.endDate=ko.observable(),this.owner=ko.observable(),this.ownerOptions=ko.observableArray([]),this.progress=ko.observable(),this.disableOwner=ko.observable(!0),this.headerLabel=ko.observable(),this.filterName=ko.observable(),this.filterOwnerName=ko.observable(),this.submit=function(){if(this.taskName()||this.startDate()||this.endDate()||this.owner()||this.progress()){if(!e.startDate()){let t=new Date("October 15, 1920 05:35:32").toISOString().split("T")[0];e.startDate(t)}if(!e.endDate()){let t=new Date("October 15, 2120 05:35:32").toISOString().split("T")[0];e.endDate(t)}if(e.progress()){if(e.progress()<0||e.progress()>100)return void window.system.showMessage("error",window.system.translateWord("wrongProgressFieldDynamicFilter"))}else e.progress(-1);e.owner()||e.owner(-1),window.dom.publish(e.targetTab(),e),$("#cancel-filter").click()}else window.system.showMessage("warn",window.system.translateWord("emptyFieldsdynamicFilter"))}}let taskTimelineControllerViews={"task-timline-controller":"/cordys/html5/demo/TaskManagement/pages/report/views/task-timeline.html"},taskTimelineControllerStyles=["/cordys/html5/demo/commons/styles/daterangepicker.css","/cordys/html5/demo/commons/styles/selectize.css","/cordys/html5/demo/TaskManagement/pages/report/resources/styles/style.css"],taskTimelineControllerScripts=["/cordys/html5/demo/TaskManagement/pages/report/model/report-model.js","/cordys/html5/demo/TaskManagement/pages/report/resources/javascript/gstatic.js","/cordys/html5/demo/TaskManagement/pages/report/resources/javascript/moment.js","/cordys/html5/demo/commons/javascripts/ui/selectize.js","/cordys/html5/demo/commons/javascripts/daterangepicker.js","/cordys/html5/demo/commons/services/shared-verticals-service.js"],taskTimelineControllerLang=["/cordys/html5/demo/TaskManagement/pages/report/resources/language-pack/report-"+window.lang+".json"];var dependency=Dependency.getInstance();dependency.addToTrigger("taskTimelineControllerOnReady"),dependency.execute("taskTimelineController");let taskTimelineViewModel=null,taskTimelineChartGraph=null;function taskTimelineControllerOnload(){dependency.initializeSystemObject(["translatePage","showLoader","extendSelectize","handleError"]),dependency.initializeDomObject(["drawRadialBarChart","subscribe"]),window.system.extendSelectize(),window.system.translatePage("task-timline-controller","task-timline-controller"),taskTimelineViewModel=new TaskTimelineViewModel,ko.applyBindings(taskTimelineViewModel,$("#task-timeline-graph")[0]),google.charts.load("current",{packages:["timeline"]}),google.charts.setOnLoadCallback(initializeChartObject)}function taskTimelineControllerOnReady(){SharedVerticalsService().getSubUsersWithModel(taskTimelineViewModel.taskTeamOptions,window.user.details.UserEntityId,""),$("#report-task-team input").on("input",function(){SharedVerticalsService().getSubUsersWithModel(taskTimelineViewModel.taskTeamOptions,window.user.details.UserEntityId,this.value)}),TaskService().autocompleteProjectOptions(taskTimelineViewModel.taskProjectOptions,this.value),$("#task-timeline-project input").on("input",function(){TaskService().autocompleteProjectOptions(taskTimelineViewModel.taskProjectOptions,this.value)})}function initializeChartObject(){var e=document.getElementById("task-timeline");taskTimelineChartGraph=new google.visualization.Timeline(e),taskTimelineViewModel.isLoaded=!0,updateTaskTimeLine()}function renderTaskTimelineChartObject(e){taskTimelineChartGraphDataTable=new google.visualization.DataTable,taskTimelineChartGraphDataTable.addColumn({type:"string",id:"Role"}),taskTimelineChartGraphDataTable.addColumn({type:"string",id:"Name"}),taskTimelineChartGraphDataTable.addColumn({type:"string",id:"style",role:"style"}),taskTimelineChartGraphDataTable.addColumn({type:"date",id:"Start"}),taskTimelineChartGraphDataTable.addColumn({type:"date",id:"End"}),taskTimelineChartGraphDataTable.addColumn({type:"string",role:"tooltip"}),taskTimelineChartGraphDataTable.addRows(e),0==e.length?($("#task-timeline-empty").css("display","block"),$("#task-timeline-holder").css("display","none")):($("#task-timeline-empty").css("display","none"),$("#task-timeline-holder").css("display","block"));var t={width:$("#task-timline-controller").width(),height:500,tooltip:{isHtml:!0},avoidOverlappingGridLines:!0};taskTimelineChartGraph.draw(taskTimelineChartGraphDataTable,t)}function updateTaskTimeLine(){if(0==taskTimelineViewModel.taskStartDate().length||0==taskTimelineViewModel.taskEndDate().length)return;let e=new Date(taskTimelineViewModel.taskStartDate()[0]._d);e=moment(e).format("YYYY-MM-DD");let t=new Date(taskTimelineViewModel.taskEndDate()[0]._d);t=moment(t).format("YYYY-MM-DD"),e=encodeURIComponent(e),t=encodeURIComponent(t);let a=";";for(var s=0;s<taskTimelineViewModel.taskTeam().length;s++)0==s&&(a=""),s>0&&(a+=","),a+=taskTimelineViewModel.taskTeam()[s].split(":")[0];a=encodeURIComponent(a);let i=0;taskTimelineViewModel.taskProject()&&(i=""==(i=taskTimelineViewModel.taskProject()[0])?0:i.split(":")[0]);let n=taskTimelineViewModel.taskStatus();n||(n=0),_CordysRequest().serverGetRequest("api/task/task-timeline/"+e+"/"+t+"/"+a+"/"+i+"/"+n,function(e){if(""==e)return $("#task-timeline-empty").css("display","block"),void $("#task-timeline-holder").css("display","none");if(""==e.response)return $("#task-timeline-empty").css("display","block"),void $("#task-timeline-holder").css("display","none");if("[]"==JSON.parse(e.response).data)return $("#task-timeline-empty").css("display","block"),void $("#task-timeline-holder").css("display","none");console.log(JSON.parse(JSON.parse(e.response).data)),e=JSON.parse(JSON.parse(e.response).data);let t=[];for(var a=0;a<e.length;a++)for(var s=0;s<e[a].data.length;s++)t.push([e[a].data[s].x,e[a].name+" -%"+e[a].data[s].tooltip,e[a].data[s].color,new Date(e[a].data[s].y[1]),new Date(e[a].data[s].y[0]),e[a].data[s].tooltip+"%"]);taskTimelineViewModel.isLoaded&&renderTaskTimelineChartObject(t)})}function IsValidTaskDates(){if(0==taskTimelineViewModel.taskStartDate().length||0==taskTimelineViewModel.taskEndDate().length)return!1;let e=new Date(taskTimelineViewModel.taskStartDate()[0]._d);e=moment(e);let t=new Date(taskTimelineViewModel.taskEndDate()[0]._d);return t=moment(t),e.diff(t,"days")>0?(taskTimelineViewModel.dateErrorClass("has-error"),!1):(taskTimelineViewModel.dateErrorClass(""),!0)}function TaskTimelineViewModel(){this.isLoaded=!1,this.taskStartDate=ko.observableArray(),this.taskEndDate=ko.observableArray(),this.taskTeamOptions=ko.observableArray(),this.taskTeam=ko.observableArray(),this.dateErrorClass=ko.observable(""),this.dateErrorMessage=ko.observable(window.system.translateWord("task-date-validation-ErrorMessage")),this.taskProjectOptions=ko.observableArray(),this.taskProject=ko.observable(),this.taskProject.subscribe(function(e){updateTaskTimeLine()}),this.taskStatusOptions=ko.observableArray([{id:1,name:window.system.translateWord("inProgress")},{id:2,name:window.system.translateWord("delayed")},{id:3,name:window.system.translateWord("closed")},{id:4,name:window.system.translateWord("all")}]),this.taskStatus=ko.observable(),this.taskStatus.subscribe(function(e){updateTaskTimeLine()}),this.taskTeam.subscribe(function(e){updateTaskTimeLine()}),this.taskStartDate.subscribe(function(e){IsValidTaskDates()&&updateTaskTimeLine()}),this.taskEndDate.subscribe(function(e){IsValidTaskDates()&&updateTaskTimeLine()})}const taskCreateProgramControllerViews={"program-create":"/cordys/html5/demo/TaskManagement/pages/program/view/program-create.html"},taskCreateProgramControllerStyles=[],taskCreateProgramControllerScripts=["/cordys/html5/demo/TaskManagement/pages/program/service/program-service.js","/cordys/html5/demo/TaskManagement/pages/program/model/program-model.js"];window.selectedOption=[];var dependency=Dependency.getInstance();dependency.addToTrigger("taskCreateProgramControllerOnReady"),dependency.execute("taskCreateProgramController");let programModel=null;function taskCreateProgramControllerOnload(){dependency.initializeSystemObject(["translatePage","showMessage","translateWord","extendSelectize","showLoader","getMinDate","handleError"]),programModel=new programObject,window.system.translatePage(window.lang,"program","TaskManagement","program-create"),dependency.initializeValidation(),window.kovalidation.initializeValidation(programModel),ko.applyBindings(programModel,document.getElementById("program-create"))}function taskCreateProgramControllerOnReady(){$("#program-create").on("shown.bs.modal",function(){restProgram()}),autocompleteProgramOwnerOptions("",!0),$("#program-create #program-owner input").on("input",function(){autocompleteProgramOwnerOptions(this.value)})}function autocompleteProgramOwnerOptions(e,r){-1!=["MSM","USM","AAM","EXM","OFC"].indexOf(window.user.details.UserUnitTypeCode)?SharedModel().getUserUnderUnitsByUnitCodes("MSM,USM,AAM,EXM,OFC",window.user.details.UnitPathById,e).done(function(e){if(!e.tuple[0])return;programModel.ownerDimmed("");var r=e.tuple[0].old.rowset.row;let a=[];if(r instanceof Array)for(let e=0;e<r.length;e++)a.push({id:r[e].UserEntityId,name:r[e].DisplayName});else a.push({id:r.UserEntityId,name:r.DisplayName});programModel.programOwnerOptions(a)}):(programModel.ownerDimmed("dimmed"),addProgramCurrentUserToBeOwner([]))}function addProgramCurrentUserToBeOwner(e){e.push({id:window.user.details.UserEntityId,name:window.user.details.DisplayName}),programModel.programOwnerOptions(e),programModel.programOwner([window.user.details.UserEntityId])}function programObject(){var e=this;e.ownerDimmed=ko.observable("dimmed"),e.isEdit=ko.observable(""),e.hasError=ko.observable(!0),e.minDate=ko.observable(window.system.getMinDate()),e.programName=ko.observable().extend({required:{params:!0,message:window.system.translateWord("requiredField")},maxLength:{params:200,message:window.system.translateWord("maxLength200")},modletter:{params:!0,message:window.system.translateWord("specialCharNotAllowed")}}),e.programEndDate=ko.observable().extend({required:{params:!0,message:window.system.translateWord("requiredField")},date:{params:!0,message:window.system.translateWord("requiredDate")},biggerThanDate:{params:e.programStartDate,message:window.system.translateWord("biggerThanDate")},min:e.minDate()}),e.programStartDate=ko.observable().extend({required:{params:!0,message:window.system.translateWord("requiredField")},date:{params:!0,message:window.system.translateWord("requiredDate")},smallerThanDate:{params:e.programEndDate,message:window.system.translateWord("smallerThanDate")}}),e.programStartDate.subscribe(function(r){r.length<2||e.minDate(r)}),e.programOwnerOptions=ko.observableArray(),e.programOwner=ko.observable({required:{params:!0,message:window.system.translateWord("requiredField")}}),e.programCreatedBy=ko.observable(),e.status=ko.observable(),e.programNotes=ko.observable().extend({maxLength:{params:4e3,message:window.system.translateWord("maxLength4000")}}),e.programDescription=ko.observable().extend({required:{params:!0,message:window.system.translateWord("requiredField")},maxLength:{params:4e3,message:window.system.translateWord("maxLength4000")},modletter:{params:!0,message:window.system.translateWord("specialCharNotAllowed")}}),e.programStatus=ko.observable(),e.programProgress=ko.observable(),e.buttonText=ko.observable(window.system.translateWord("add")),e.programSubmit=function(){e.programOwner()&&0!==e.programOwner().length||e.programOwner(window.user.details.UserEntityId),e.programCreatedBy(window.user.details.UserEntityId),e.programProgress(0),e.programStatus(1),ProgramModel().createProgram(e).done(function(){$("#mod-btn-program-close").click(),window.system.showLoader(!1);var e=$("#program-create").attr("program-success");e&&e.length>3&&window[e](),window.dom.publish("reload-report",!0)}).fail(function(e){window.system.handleError(e),window.system.showLoader(!1)})}}function restProgram(){programModel.programOwnerOptions([]),programModel.hasError(!0),programModel.programOwner(""),autocompleteProgramOwnerOptions("",!0),programModel.programEndDate(""),programModel.programStartDate(""),programModel.programName(""),programModel.programDescription(""),programModel.programNotes(""),window.system.showLoader(!1),programModel&&programModel.errors&&programModel.errors.showAllMessages(!1)}const programEditControllerViews={"program-edit":"/cordys/html5/demo/TaskManagement/pages/program/view/program-create.html"},programEditControllerStyles=["/cordys/html5/demo/commons/styles/selectize.css"],programEditControllerScripts=["/cordys/html5/demo/TaskManagement/pages/program/service/program-service.js","/cordys/html5/demo/TaskManagement/pages/program/model/program-model.js","/cordys/html5/demo/commons/javascripts/selectize-index.js","/cordys/html5/demo/commons/javascripts/selectize.min.js"];window.selectedOption=[];var dependency=Dependency.getInstance();dependency.addToTrigger("programEditControllerOnReady"),dependency.execute("programEditController");let programEditViewModel=null;function programEditControllerOnload(){programEditViewModel=new ProgramEditViewModel;var e=System(["getLanguage","handleUnAuthorizedEntry","removeNullAndUndefined","translatePage","deleteMethods","extendSelectize"]);let r=e.getLanguage();e.translatePage(r,"program","TaskManagement","program-edit"),dependency.initializeValidation(),e.extendSelectize(),window.kovalidation.initializeValidation(programEditViewModel),ko.applyBindings(programEditViewModel,document.getElementById("program-edit")),Dom().subscribe("edit-program-by-id",function(r){restEditProgram(programEditViewModel),ProgramModel().getProgramByIdAndOwner(r).done(function(r){r.tuple[0]?((r=e.removeNullAndUndefined(r.tuple[0].old.rowset.row)).startDate=r.startDate.split("T")[0],r.endDate=r.endDate.split("T")[0],$("#program-edit").modal(),bindEditProgram(r)):e.handleUnAuthorizedEntry()}).fail(function(r){e.handleError(r)})}),Dom().subscribe("edit-program",function(e){console.log("edit-program"),console.log(e),bindEditProgram(e)})}function bindEditProgram(e){programEditViewModel.programName(e.name),programEditViewModel.programEndDate(e.endDate),programEditViewModel.programStartDate(e.startDate),programEditViewModel.programOwnerOptions([{id:e.owner+":"+e.DisplayName,name:e.DisplayName}]),programEditViewModel.programOwner([e.owner+":"+e.DisplayName]),programEditViewModel.programCreatedBy(e.createdBy),programEditViewModel.status(e.status),programEditViewModel.programNotes(e.notes),programEditViewModel.programDescription(e.description),programEditViewModel.Id(e.Id)}function programEditControllerOnReady(){$("#program-edit #program-owner input").on("input",function(){drawEditProgramOwnerOptions(this.value)})}function drawEditProgramOwnerOptions(e){TaskModel().getOwners(e,!0).done(function(e){if(!e.tuple[0])return;var r=e.tuple[0].old.rowset.row;let a=[];if(r instanceof Array)for(let e=0;e<r.length;e++)console.log(r[e]),a.push({id:r[e].UserEntityId+":"+r[e].DisplayName,name:r[e].DisplayName});else a.push({id:r.UserEntityId+":"+r[i].DisplayName,name:r.DisplayName});programEditViewModel.programOwnerOptions(a)})}function ProgramEditViewModel(){var e=this;e.ownerDimmed=ko.observable("dimmed"),e.isEdit=ko.observable("dimmed");let r=System();r.deleteMethods(["translateWord","handleError","showMessage","showLoader","getMinDate"],r),e.minDate=ko.observable(r.getMinDate()),e.hasError=ko.observable(!0),e.Id=ko.observable().extend({required:!0}),e.programName=ko.observable().extend({required:{params:!0,message:r.translateWord("requiredField")},maxLength:{params:200,message:r.translateWord("maxLength200")},modletter:{params:!0,message:r.translateWord("specialCharNotAllowed")}}),e.programEndDate=ko.observable().extend({required:{params:!0,message:r.translateWord("requiredField")},date:{params:!0,message:r.translateWord("requiredDate")},biggerThanDate:{params:e.programStartDate,message:r.translateWord("biggerThanDate")}}),e.programStartDate=ko.observable().extend({required:{params:!0,message:r.translateWord("requiredField")},date:{params:!0,message:r.translateWord("requiredDate")},smallerThanDate:{params:e.programEndDate,message:r.translateWord("smallerThanDate")}}),e.programStartDate.subscribe(function(r){r.length<2||e.minDate(r)}),e.programOwnerOptions=ko.observableArray(),e.programOwner=ko.observable().extend({required:{params:!0,message:r.translateWord("requiredField")}}),e.programOwner.subscribe(function(r){r.length<1||""==r[0]||e.ownerId(r[0].split(":")[0])}),e.ownerId=ko.observable(),e.programCreatedBy=ko.observable(),e.status=ko.observable(),e.programNotes=ko.observable().extend({maxLength:{params:4e3,message:r.translateWord("maxLength4000")},modletter:{params:!0,message:r.translateWord("specialCharNotAllowed")}}),e.programDescription=ko.observable().extend({maxLength:{params:4e3,message:r.translateWord("maxLength4000")},modletter:{params:!0,message:r.translateWord("specialCharNotAllowed")}}),e.programStatus=ko.observable(),e.programProgress=ko.observable(),e.buttonText=ko.observable(r.translateWord("edit")),e.programSubmit=function(){r.showLoader(!0),e.programOwner()&&0!==e.programOwner().length||e.programOwner(window.user.details.UserEntityId),programEditViewModel.hasError(!0),ProgramModel().updateProgram(programEditViewModel).done(function(){r.showLoader(!1),$("#program-edit #mod-btn-program-close").click(),r.showMessage("success",r.translateWord("updateSuccess"));let e=$("#program-edit").attr("program-success");e?window[e]():location.reload(!0),programEditViewModel.hasError(!1)}).fail(function(e){r.handleError(e),programEditViewModel.hasError(!1)})}}function restEditProgram(e){e.programOwner(""),e.programEndDate(""),e.programStartDate(""),e.programName(""),e.programDescription(""),e.programNotes("")}const programControllerViews={"inprogress-program":"/cordys/html5/demo/TaskManagement/pages/program/view/program-table.html","stopped-program":"/cordys/html5/demo/TaskManagement/pages/program/view/program-table.html","ended-program":"/cordys/html5/demo/TaskManagement/pages/program/view/program-table.html"},programControllerStyles=[],programControllerScripts=["/cordys/html5/demo/TaskManagement/pages/program/service/program-service.js","/cordys/html5/demo/TaskManagement/pages/program/model/program-model.js","/cordys/html5/demo/TaskManagement/pages/shared/controller/program-confirmation-controller.js"];var dependency=Dependency.getInstance();dependency.execute("programController");let programObjects={programInProgressViewModel:null,programStopViewModel:null,programEndViewModel:null,model:null,currentTab:1},programFilterObject={sortBy:"endDate",sortDir:"sortAsc",freeText:"",progress:-1,startDate:null,endDate:null,filterOwner:""};function programControllerOnload(){dependency.initializeSystemObject(["getLanguage","translatePage","showLoader","translateWord","getPageCount","showMessage","encrypt","removeNullAndUndefined"]),dependency.initializeDomObject(["sortable","subscribe","publish","drawPagination"]);let r=window.system.getLanguage();window.system.translatePage(r,"program","TaskManagement","program-container");var e=document.getElementById("inprogress-program").getElementsByClassName("main-table")[0];window.dom.sortable(e,"fillInprogressProgram");var o=document.getElementById("ended-program").getElementsByClassName("main-table")[0];window.dom.sortable(o,"fillEndedProgram");var t=document.getElementById("stopped-program").getElementsByClassName("main-table")[0];window.dom.sortable(t,"fillStoppedProgram"),programObjects.programInProgressViewModel=new ProgramViewModel,ko.applyBindings(programObjects.programInProgressViewModel,e),programObjects.programEndViewModel=new ProgramViewModel,ko.applyBindings(programObjects.programEndViewModel,o),programObjects.programStopViewModel=new ProgramViewModel,ko.applyBindings(programObjects.programStopViewModel,t),programObjects.model=ProgramModel(["changeProgramStatus","readProgram","countProgram","deleteProgram"]),window.dom.subscribe("inprogress-program",function(r){drawInProgressProgram(r.taskName(),r.progress(),r.startDate(),r.endDate(),r.owner())}),window.dom.subscribe("ended-program",function(r){drawEndedProgram(r.taskName(),r.progress(),r.startDate(),r.endDate(),r.owner())}),window.dom.subscribe("stopped-program",function(r){drawStoppedProgram(r.taskName(),r.progress(),r.startDate(),r.endDate(),r.owner())})}function setProgramFilterObject(r,e,o,t,a){programFilterObject.sortBy="programName",programFilterObject.sortDir="sortAsc",programFilterObject.progress=e||-1,programFilterObject.filterOwner=a||-1,programFilterObject.freeText=r||($("#search-input").val()||""),programFilterObject.startDate=o||new Date("October 14, 1920 05:35:32").toISOString().split("T")[0],programFilterObject.endDate=t||new Date("October 14, 2120 05:35:32").toISOString().split("T")[0]}function drawInProgressProgram(r,e,o,t,a){setProgramFilterObject(r,e,o,t,a),$("#program-create").attr("program-success","drawInProgressProgram"),$("#program-edit").attr("program-success","drawInProgressProgram"),countProgram("countProgram",1,document.getElementById("inprogress-program"),fillInprogressProgram,programFilterObject),fillInprogressProgram()}function fillInprogressProgram(r,e,o){readProgram(1,r,e,o,"inprogress-program")}function drawEndedProgram(r,e,o,t,a){setProgramFilterObject(r,e,o,t,a),$("#program-create").attr("program-success","drawEndedProgram"),$("#program-edit").attr("program-success","drawEndedProgram"),countProgram("countProgram",2,document.getElementById("ended-program"),fillEndedProgram,programFilterObject),fillEndedProgram()}function fillEndedProgram(r,e,o){readProgram(2,r,e,o,"ended-program")}function drawStoppedProgram(r,e,o,t,a){setProgramFilterObject(r,e,o,t,a),$("#program-create").attr("program-success","drawStoppedProgram"),$("#program-edit").attr("program-success","drawStoppedProgram"),countProgram("countProgram",3,document.getElementById("stopped-program"),fillStoppedProgram,programFilterObject),fillStoppedProgram()}function fillStoppedProgram(r,e,o){readProgram(3,r,e,o,"stopped-program")}function showLoaderBasedOnStatus(r){let e="inprogress-program";1==r?e="inprogress-program":2==r?e="ended-program":3==r&&(e="stopped-program"),window.system.showLoader(!0,document.getElementById(e))}function changeProgramStatus(r,e,o){showLoaderBasedOnStatus(programObjects.currentTab),programObjects.model.changeProgramStatus(r,e).done(function(r){let e=$(o).closest("tr"),t=$(e).next("tr");$(e).remove(),$(t).remove(),window.system.showMessage("success",window.system.translateWord("updateProgramStatusSuccess")),window.system.showLoader(!1),window.dom.publish("reload-report",!0)}).fail(function(r){window.system.handleError(r),window.system.showLoader(!1)})}function addAdditionalAttributesToProgramResponse(r){r.endDate=r.endDate.split("T")[0],r.startDate=r.startDate.split("T")[0];let e=r.programProgress;isNaN(e)&&(e=0),e|=0;let o=System().getDifferenceBetweenTwoDatesWithoutABS(new Date(r.startDate),new Date(r.endDate)),t=System().getDifferenceBetweenTwoDatesWithoutABS(new Date(r.startDate),new Date)/o*100;100==e?r.progressColor="progress-bar":e<t+10&&e>t-10?r.progressColor="progress-bar-gold":e>t?r.progressColor="progress-bar":e<t&&(r.progressColor="progress-bar-red"),r.programProgress=e+"%",r.isOwner=!1,r.isEnded=!1,r.isStopped=!1,r.isInprogresss=!1;let a=parseInt(r.status);1==a?r.isInprogresss=!0:2==a?r.isEnded=!0:3==a&&(r.isStopped=!0),r.haveDelete=!0,parseInt(r.progress)>0&&(r.haveDelete=!1);let s=window.user.details.UserEntityId;return s!=r.createdBy&&s!=r.owner||(r.isOwner=!0),r.openProgramCollapse=function(r,e){$(e.target).parent().toggleClass("open").next(".fold").toggleClass("open")},r.displayProgram=function(r,e){let o=window.system.encrypt(r.Id);var t=assetConfig.domain+"/home/mod/html5/demo/TaskManagement/pages/program/program-display.html?programId="+o;window.top.location=t},r.editProgram=function(r){window.dom.publish("edit-program-by-id",parseInt(r.Id))},r.stopProgram=function(r,e){let o={callBack:confirmActionProgram,id:r.Id,status:3,element:e.target};window.dom.publish("stop-program",o)},r.endProgram=function(r,e){let o={callBack:confirmActionProgram,id:r.Id,status:2,element:e.target};window.dom.publish("end-program",o)},r.completeProgram=function(r,e){let o={callBack:confirmActionProgram,id:r.Id,status:1,element:e.target};window.dom.publish("complete-program",o)},r.deleteProgram=function(r,e){showLoaderBasedOnStatus(programObjects.currentTab),programObjects.model.deleteProgram(r.Id).done(function(){let r=$(e.target).closest("tr"),o=$(r).next("tr");$(r).remove(),$(o).remove(),window.system.showLoader(!1),window.system.showMessage("success",window.system.translateWord("deleteSuccess"))}).fail(function(r){window.system.showLoader(!1),window.system.handleError(r)})},r}function confirmActionProgram(r,e,o){changeProgramStatus(r,e,o)}function readProgram(r,e,o,t,a){e=e||1,pageSize=10,o=o||"endDate",t=t||"sortAsc",window.system.showLoader(!0,document.getElementById(a)),programObjects.model.readProgram(r,e,pageSize,o,t,programFilterObject).done(function(e){if(e.tuple[0]){if((e=e.tuple[0].old.rowset.row)instanceof Array)for(let r=0;r<e.length;r++)e[r]=window.system.removeNullAndUndefined(e[r]),e[r]=addAdditionalAttributesToProgramResponse(e[r]);else e=addAdditionalAttributesToProgramResponse(e=window.system.removeNullAndUndefined(e));1==r?programObjects.programInProgressViewModel.programs(e):2==r?programObjects.programEndViewModel.programs(e):3==r&&programObjects.programStopViewModel.programs(e),window.system.showLoader(!1)}else window.system.showLoader(!1)}).fail(function(r){window.system.handleError(r),window.system.showLoader(!1)})}function countProgram(r,e,o,t,a){programObjects.programInProgressViewModel.programs([]),programObjects.programStopViewModel.programs([]),programObjects.programEndViewModel.programs([]),programObjects.currentTab=e,window.system.showLoader(!0,o),programObjects.model.countProgram(r,e,a).done(function(r){window.system.showLoader(!1);var e=Math.ceil(r.count.text/window.system.getPageCount());0!=e&&window.dom.drawPagination(o.getElementsByClassName("pagination")[0],e,t)}).fail(function(r){window.system.handleError(r),window.system.showLoader(!1)})}function ProgramViewModel(){this.programs=ko.observableArray([]),this.tab=ko.observable()}const projectCreateControllerViews={"project-create":"/cordys/html5/demo/TaskManagement/pages/project/view/project-create.html"},projectCreateControllerStyles=["/cordys/html5/demo/commons/styles/selectize.css"],projectCreateControllerScripts=["/cordys/html5/demo/TaskManagement/pages/project/model/project-model.js","/cordys/html5/demo/TaskManagement/pages/project/service/project-service.js","/cordys/html5/demo/TaskManagement/pages/program/model/program-model.js","/cordys/html5/demo/TaskManagement/pages/task/model/task-model.js","/cordys/html5/demo/TaskManagement/pages/shared/model/shared-model.js","/cordys/html5/demo/commons/javascripts/selectize-index.js","/cordys/html5/demo/commons/javascripts/selectize.min.js"];var dependency=Dependency.getInstance();dependency.addToTrigger("projectCreateControllerOnReady"),dependency.execute("projectCreateController");let projectCreateViewModel=null;function projectCreateControllerOnload(){var e=System();let t=e.getLanguage();e.extendSelectize(),e.translatePage(t,"project","TaskManagement","project-create"),projectCreateViewModel=new ProjectCreateViewModel,KOValidation().initializeValidation(projectCreateViewModel),ko.applyBindings(projectCreateViewModel,document.getElementById("project-create"))}function projectCreateControllerOnReady(){let e=ProjectService();e.autoCompleteProjectOwner("",projectCreateViewModel),e.autoCompleteProjectRelateProg("",projectCreateViewModel),$("#project-create").on("shown.bs.modal",function(){restProject()}),$("#project-manager-id input").on("input",function(){e.autoCompleteProjectOwner(this.value,projectCreateViewModel)}),$("#project-relate-prog-id input").on("input",function(){e.autoCompleteProjectRelateProg(this.value,projectCreateViewModel)}),setAssignToUnit(),"USM"!=window.user.details.UserUnitTypeCode&&"MSM"!=window.user.details.UserUnitTypeCode||(projectCreateViewModel.institutionalPlanMandatory(!1),projectCreateViewModel.insitutionalPlanRequired(""))}function setAssignToUnit(){projectCreateViewModel.assignToUnit([]),projectCreateViewModel.assignToUnitOptions([]),"DIR"==window.user.details.UserUnitTypeCode||"DIV"==window.user.details.UserUnitTypeCode?(projectCreateViewModel.assignToUnitOptions.push({id:window.user.details.UnitId+":"+window.user.details.UnitPathById,name:window.user.details.UnitName}),projectCreateViewModel.assignToUnitOptions(projectCreateViewModel.assignToUnitOptions())):(projectService.autoCompleteAssignToUnit("",projectCreateViewModel),$("#assign-to-unit-id .selectize-input input").on("input",function(){projectService.autoCompleteAssignToUnit(this.value,projectCreateViewModel)})),projectCreateViewModel.errors.showAllMessages(!1)}function restProject(){projectCreateViewModel.institutionalPlanOptions([]),projectCreateViewModel.institutionalPlanOptions([{name:"الخطة المؤسسية",id:122}]),projectCreateViewModel.projectRelateProgOptions([]),projectCreateViewModel.assignToUnitOptions([]),projectCreateViewModel.projectManagerOptions([]),projectService.autoCompleteProjectOwner("",projectCreateViewModel),projectService.autoCompleteProjectRelateProg("",projectCreateViewModel),projectCreateViewModel.assignToUnitNotSelected("dimmed"),projectCreateViewModel.projectName(""),projectCreateViewModel.institutionalPlan([]),setAssignToUnit(),projectCreateViewModel.projectManager([]),projectCreateViewModel.projectRelateProg([]);let e=$("#institutional-plan").parent().find(".item:first");e.attr("data-value",""),e.html("");let t=$("#assign-to-unit").parent().find(".item:first");t.attr("data-value",""),t.html("");let o=$("#project-manager").parent().find(".item:first");o.attr("data-value",""),o.html("");let r=$("#project-relate-prog").parent().find(".item:first");r.attr("data-value",""),r.html(""),projectCreateViewModel.projectEndDate(""),projectCreateViewModel.projectStartDate(""),projectCreateViewModel.selectedStartDate(""),projectCreateViewModel.minDate(""),projectCreateViewModel.maxDate(""),projectCreateViewModel.projectDescription(""),projectCreateViewModel.projectNotes(""),projectCreateViewModel.userUnitId(""),projectCreateViewModel.createdBy(""),System().showLoader(!1),projectCreateViewModel&&projectCreateViewModel.errors&&projectCreateViewModel.errors.showAllMessages(!1)}function ProjectCreateViewModel(){var e=this;e.isEdit=ko.observable(""),e.hasError=ko.observable(!0),e.assignToUnitNotSelected=ko.observable("dimmed"),e.selectedStartDate=ko.observable(window.system.getMinDate()),e.minDate=ko.observable(window.system.getMinDate()),e.maxDate=ko.observable(new Date("October 15, 2120 05:35:32").toISOString().split("T")[0]),e.title=ko.observable(window.system.translateWord("add-project")),e.textBtn=ko.observable(window.system.translateWord("add")),e.projectName=ko.observable().extend({required:{params:!0,message:window.system.translateWord("requiredField")},maxLength:{params:200,message:window.system.translateWord("maxLength200")},modletter:{params:!0,message:window.system.translateWord("specialCharNotAllowed")}}),e.projectManagerOptions=ko.observableArray(),e.projectManager=ko.observable().extend(),e.institutionalPlanOptions=ko.observableArray([{name:"الخطة المؤسسية",id:122}]),e.insitutionalPlanRequired=ko.observable("property-required"),e.institutionalPlanMandatory=ko.observable(!0),e.institutionalPlan=ko.observable().extend({required:{params:!0,message:window.system.translateWord("requiredField"),onlyIf:function(){return!0===e.institutionalPlanMandatory()}}}),e.assignToUnitOptions=ko.observableArray(),e.assignToUnit=ko.observable().extend({required:{params:!0,message:window.system.translateWord("requiredField")}}),e.assignToUnit.subscribe(function(t){0==t.length?e.assignToUnitNotSelected("dimmed"):""==t[0]?e.assignToUnitNotSelected("dimmed"):e.assignToUnitNotSelected("")}),e.assignToUnit.subscribe(function(e){projectService.autoCompleteProjectOwner("",projectCreateViewModel)}),e.projectRelateProgOptions=ko.observableArray(),e.projectRelateProg=ko.observable(),e.projectRelateProg.subscribe(function(t){if(""==t)return;let o=t[0].split(":")[1],r=t[0].split(":")[2];r&&(e.minDate(o),e.maxDate(r))}),e.projectEndDate=ko.observable().extend({required:{params:!0,message:window.system.translateWord("requiredField")},date:{params:!0,message:window.system.translateWord("requiredDate")},smallerThanDate:{params:e.maxDate,message:window.system.translateWord("smallerThanDate")}}),e.projectStartDate=ko.observable().extend({required:{params:!0,message:window.system.translateWord("requiredField")},date:{params:!0,message:window.system.translateWord("requiredDate")},smallerThanDate:{params:e.projectEndDate,message:window.system.translateWord("smallerThanDate")}}),e.projectStartDate.subscribe(function(t){t.length<2||e.selectedStartDate(t)}),e.projectDescription=ko.observable().extend({required:{params:!0,message:window.system.translateWord("requiredField")},maxLength:{params:4e3,message:window.system.translateWord("maxLength4000")},modletter:{params:!0,message:window.system.translateWord("specialCharNotAllowed")}}),e.projectNotes=ko.observable().extend({maxLength:{params:4e3,message:window.system.translateWord("maxLength4000")},modletter:{params:!0,message:window.system.translateWord("specialCharNotAllowed")}}),e.userUnitId=ko.observable(),e.createdBy=ko.observable(),e.projectStatus=ko.observable(),e.projectSubmit=function(){let t=System();t.showLoader(!0),e.userUnitId(window.user.details.UnitId),e.createdBy(window.user.details.UserEntityId),e.projectStatus(1),e.projectManager()||e.projectManager(window.user.details.UserEntityId),ProjectService().createProject(e).done(function(o){$("#mod-btn-project-close").click();var r=$("#project-create").attr("project-success");r&&r.length>3&&window[r](),restProject(e),window.dom.publish("reload-report",!0),t.showLoader(!1)}).fail(function(e){t.showLoader(!1)})},e.projectClose=function(){restProject(e)},e.errors=ko.validation.group(e)}const projectControllerViews={"inprogress-project":"/cordys/html5/demo/TaskManagement/pages/project/view/project-table.html","stopped-project":"/cordys/html5/demo/TaskManagement/pages/project/view/project-table.html","ended-project":"/cordys/html5/demo/TaskManagement/pages/project/view/project-table.html"},projectControllerStyles=[],projectControllerScripts=["/cordys/html5/demo/TaskManagement/pages/project/service/project-service.js","/cordys/html5/demo/TaskManagement/pages/shared/controller/project-confirmation-controller.js","/cordys/html5/demo/TaskManagement/pages/project/model/project-model.js","/cordys/html5/demo/commons/javascripts/jquery.twbsPagination.js"];let projectService=null,projectObjectController={projectInProgressViewModel:null,projectEndViewModel:null,projectStopViewModel:null,currentTab:1},projectFilterObject={sortBy:"projectName",sortDir:"sortAsc",freeText:"",progress:-1,startDate:null,endDate:null,filterOwner:""};var dependency=Dependency.getInstance();function projectControllerOnload(){dependency.initializeSystemObject(["getLanguage","translatePage","showLoader","translateWord","getPageCount","showMessage","getAutoCompleteCount"]),dependency.initializeDomObject(["sortable","subscribe","publish","drawPagination"]);let e=window.system.getLanguage();window.system.translatePage(e,"project","TaskManagement","project-container"),projectService=ProjectService();var t=document.getElementById("inprogress-project").getElementsByClassName("main-table")[0];window.dom.sortable(t,"fillInProgressProjectTable");var o=document.getElementById("ended-project").getElementsByClassName("main-table")[0];window.dom.sortable(o,"fillEndedProjectTable");var r=document.getElementById("stopped-project").getElementsByClassName("main-table")[0];window.dom.sortable(r,"fillStoppedProjectTable"),projectObjectController.projectInProgressViewModel=new ProjectViewModel,ko.applyBindings(projectObjectController.projectInProgressViewModel,t),projectObjectController.projectEndViewModel=new ProjectViewModel,ko.applyBindings(projectObjectController.projectEndViewModel,o),projectObjectController.projectStopViewModel=new ProjectViewModel,ko.applyBindings(projectObjectController.projectStopViewModel,r),window.dom.subscribe("inprogress-project",function(e){drawInProgressProjects(e.taskName(),e.progress(),e.startDate(),e.endDate(),e.owner())}),window.dom.subscribe("ended-project",function(e){drawEndedProjects(e.taskName(),e.progress(),e.startDate(),e.endDate(),e.owner())}),window.dom.subscribe("stopped-project",function(e){drawStoppedProjects(e.taskName(),e.progress(),e.startDate(),e.endDate(),e.owner())})}function setProjectFilterObject(e,t,o,r,s){projectFilterObject.sortBy="endDate",projectFilterObject.sortDir="sortAsc",projectFilterObject.progress=t||-1,projectFilterObject.filterOwner=s||-1,projectFilterObject.freeText=e||($("#search-input").val()||""),projectFilterObject.startDate=o||new Date("October 14, 1920 05:35:32").toISOString().split("T")[0],projectFilterObject.endDate=r||new Date("October 14, 2120 05:35:32").toISOString().split("T")[0]}function drawInProgressProjects(e,t,o,r,s){setProjectFilterObject(e,t,o,r,s),$("#project-create").attr("project-success","drawInProgressProjects"),$("#project-edit").attr("project-success","drawInProgressProjects"),projectObjectController.currentTab=1;var n=document.getElementById("inprogress-project");window.system.showLoader(!0,n),countProject(1,n,projectFilterObject)}function fillInProgressProjectTable(e,t,o){fillProjectTable(document.getElementById("inprogress-project"),1,e,t,o)}function drawEndedProjects(e,t,o,r,s){setProjectFilterObject(e,t,o,r,s),$("#project-create").attr("project-success","drawEndedProjects"),$("#project-edit").attr("project-success","drawEndedProjects"),projectObjectController.currentTab=2;var n=document.getElementById("ended-project");window.system.showLoader(!0,n),countProject(2,n,projectFilterObject)}function fillEndedProjectTable(e,t,o){fillProjectTable(document.getElementById("ended-project"),2,e,t,o)}function fillStoppedProjectTable(e,t,o){fillProjectTable(document.getElementById("stopped-project"),3,e,t,o)}function drawStoppedProjects(e,t,o,r,s){setProjectFilterObject(e,t,o,r,s),$("#project-create").attr("project-success","drawStoppedProjects"),$("#project-edit").attr("project-success","drawStoppedProjects"),projectObjectController.currentTab=3;var n=document.getElementById("stopped-project");window.system.showLoader(!0,n),countProject(3,n,projectFilterObject)}function fillProjectTable(e,t,o,r,s){t=t||1,o=o||1;var n=window.system.getPageCount();r=r||"endDate",s=s||"sortAsc",window.system.showLoader(!0,e),ProjectModel().getProjectByStatus(t,o,n,r,s,projectFilterObject).done(function(e){if(projectObjectController.projectInProgressViewModel.projects([]),projectObjectController.projectEndViewModel.projects([]),projectObjectController.projectStopViewModel.projects([]),e.tuple[0]){if((e=e.tuple[0].old.rowset.row)instanceof Array)for(let t=0;t<e.length;t++)e[t]=window.system.removeNullAndUndefined(e[t]),e[t]=addAdditionalAttributesToProjectResponse(e[t]);else e=addAdditionalAttributesToProjectResponse(e=window.system.removeNullAndUndefined(e));1==t?projectObjectController.projectInProgressViewModel.projects(e):2==t?projectObjectController.projectEndViewModel.projects(e):3==t&&projectObjectController.projectStopViewModel.projects(e),window.system.showLoader(!1)}else window.system.showLoader(!1)}).fail(function(e){window.system.handleError(e),window.system.showLoader(!1)})}function countProject(e,t,o){e=e||1,ProjectModel().countProject("countProject",e,o).done(function(o){window.system.showLoader(!1);var r=Math.ceil(o.count.text/window.system.getPageCount());0!=r&&(window.dom.drawPagination(t.getElementsByClassName("pagination")[0],r,fillMyInProgressTaskTable),fillProjectTable(t,e))}).fail(function(e){window.system.handleError(e),window.system.showLoader(!1)})}function confirmProjectAction(e,t,o){changeProjectStatus(e,t,o)}function addAdditionalAttributesToProjectResponse(e){e.endDate=e.endDate.split("T")[0],e.startDate=e.startDate.split("T")[0];let t=e.progress;isNaN(t)&&(t=0),t|=0;let o=System().getDifferenceBetweenTwoDatesWithoutABS(new Date(e.startDate),new Date(e.endDate)),r=System().getDifferenceBetweenTwoDatesWithoutABS(new Date(e.startDate),new Date)/o*100;100==t?e.progressColor="progress-bar":t<r+10&&t>r-10?e.progressColor="progress-bar-gold":t>r?e.progressColor="progress-bar":t<r&&(e.progressColor="progress-bar-red"),e.progress=t+"%",e.isOwner=!1,e.isEnded=!1,e.isStopped=!1,e.isInprogresss=!1;let s=parseInt(e.status);1==s?e.isInprogresss=!0:2==s?e.isEnded=!0:3==s&&(e.isStopped=!0),e.haveDelete=!0,parseInt(e.taskCount)>0&&(e.haveDelete=!1),console.log(e);let n=window.user.details.UserEntityId;return n!=e.createdBy&&n!=e.owner||(e.isOwner=!0),e.openProjectCollapse=function(e,t){$(t.target).parent().toggleClass("open").next(".fold").toggleClass("open")},e.displayProject=function(e,t){let o=window.system.encrypt(e.Id);var r=assetConfig.domain+"/home/mod/html5/demo/TaskManagement/pages/project/project-display.html?projectId="+o;window.top.location=r},e.editProject=function(e){window.dom.publish("edit-project-by-id",parseInt(e.Id))},e.stopProject=function(e,t){let o={callBack:confirmProjectAction,id:e.Id,status:3,element:t.target};window.dom.publish("stop-project",o)},e.endProject=function(e,t){let o={callBack:confirmProjectAction,id:e.Id,status:2,element:t.target};window.dom.publish("end-project",o)},e.completeProject=function(e,t){let o={callBack:confirmProjectAction,id:e.Id,status:1,element:t.target};window.dom.publish("complete-project",o)},e.deleteProject=function(e,t){showProjectLoaderBasedOnStatus(projectObjectController.currentTab),ProjectModel().deleteProject(e.Id).done(function(){let e=$(t.target).closest("tr"),o=$(e).next("tr");$(e).remove(),$(o).remove(),window.system.showLoader(!1),window.system.showMessage("success",window.system.translateWord("deleteSuccess"))}).fail(function(e){window.system.showLoader(!1),window.system.handleError(e)})},e}function changeProjectStatus(e,t,o){showProjectLoaderBasedOnStatus(projectObjectController.currentTab),ProjectModel().changeProjectStatus(e,t).done(function(){let e=$(o).closest("tr"),r=$(e).next("tr");$(e).remove(),$(r).remove(),window.system.showLoader(!1);var s="";switch(t){case 1:s="project-complete-success";break;case 2:s="project-end-success";break;case 3:s="project-stop-success";break;default:s="updateProjectStatusSuccess"}window.system.showMessage("success",window.system.translateWord(s)),window.dom.publish("reload-report",!0)}).fail(function(e){window.system.handleError(e)})}function showProjectLoaderBasedOnStatus(e){let t="inprogress-project";1==e?t="inprogress-project":2==e?t="ended-project":3==e&&(t="stopped-project"),window.system.showLoader(!0,document.getElementById(t))}function ProjectViewModel(){this.projects=ko.observableArray([]),this.tab=ko.observable()}dependency.execute("projectController");const projectEditControllerViews={"project-edit":"/cordys/html5/demo/TaskManagement/pages/project/view/project-create.html"},projectEditControllerStyles=["/cordys/html5/demo/commons/styles/selectize.css"],projectEditControllerScripts=["/cordys/html5/demo/TaskManagement/pages/project/model/project-model.js","/cordys/html5/demo/TaskManagement/pages/project/service/project-service.js","/cordys/html5/demo/TaskManagement/pages/program/model/program-model.js","/cordys/html5/demo/TaskManagement/pages/task/model/task-model.js","/cordys/html5/demo/commons/javascripts/selectize-index.js","/cordys/html5/demo/commons/javascripts/selectize.min.js"];var dependency=Dependency.getInstance();dependency.addToTrigger("projectEditControllerOnReady"),dependency.execute("projectEditController");let projectEditViewModel=null;function projectEditControllerOnload(){dependency.initializeSystemObject(["getLanguage","handleUnAuthorizedEntry","removeNullAndUndefined","translatePage","translateWord","showLoader","handleError","extendSelectize","getMinDate"]),dependency.initializeDomObject(["subscribe","publish"]),projectEditViewModel=new ProjectEditViewModel;let e=window.system.getLanguage();window.system.extendSelectize(),window.system.translatePage(e,"project","TaskManagement","project-edit"),KOValidation().initializeValidation(projectEditViewModel),ko.applyBindings(projectEditViewModel,document.getElementById("project-edit")),window.dom.subscribe("edit-project-by-id",function(e){restEditProject(projectEditViewModel),ProjectModel().getProjectById(e).done(function(e){e.tuple[0]?((e=window.system.removeNullAndUndefined(e.tuple[0].old.rowset.row)).startDate=e.startDate.split("T")[0],e.endDate=e.endDate.split("T")[0],projectEditViewModel.minDate(e.endDate),$("#project-edit").modal(),bindEditProject(e)):window.system.handleUnAuthorizedEntry()}).fail(function(e){window.system.handleError(e)})})}function bindEditProject(e){console.log(e),projectEditViewModel.Id(e.Id),projectEditViewModel.projectName(e.name),projectEditViewModel.projectManagerOptions([{name:e.projectOwner,id:e.owner}]),projectEditViewModel.projectManager([e.owner]),projectEditViewModel.institutionalPlanOptions([{name:"الخطة المؤساسية",id:122}]),projectEditViewModel.institutionalPlan([122]),projectEditViewModel.assignToUnitOptions([{id:e.assignToUnitId+":"+e.UnitPathById,name:e.UnitName}]),projectEditViewModel.assignToUnit([e.assignToUnitId+":"+e.UnitPathById]),projectEditViewModel.projectRelateProgOptions([{id:e.programId,name:e.programName}]),projectEditViewModel.projectRelateProg([e.programId]),projectEditViewModel.projectEndDate(e.endDate),projectEditViewModel.projectStartDate(e.startDate),projectEditViewModel.projectDescription(e.description),projectEditViewModel.projectNotes(e.notes),projectEditViewModel.userUnitId(e.createdByUnitId),projectEditViewModel.createdBy(e.createdBy),projectEditViewModel.projectStatus(e.status),projectEditViewModel.assignToUnitNotSelected("")}function projectEditControllerOnReady(){$("#project-edit #project-manager-id input").on("input",function(){ProjectService().autoCompleteProjectOwner(this.value,projectEditViewModel,!1)}),$("#project-edit #project-relate-prog-id input").on("input",function(){ProjectService().autoCompleteProjectRelateProg(this.value,projectEditViewModel)}),"DIR"==window.user.details.UserUnitTypeCode||"DIV"==window.user.details.UserUnitTypeCode?(projectEditViewModel.assignToUnitOptions.push({id:window.user.details.UnitId+":"+window.user.details.UnitPathById,name:window.user.details.UnitName}),projectEditViewModel.assignToUnitOptions(projectEditViewModel.assignToUnitOptions()),projectEditViewModel.assignToUnit([window.user.details.UnitId+":"+window.user.details.UnitPathById])):$("#assign-to-unit-id .selectize-input input").on("input",function(){ProjectService().autoCompleteAssignToUnit(this.value,projectEditViewModel)}),"USM"!=window.user.details.UserUnitTypeCode&&"MSM"!=window.user.details.UserUnitTypeCode||(projectEditViewModel.institutionalPlanMandatory(!1),projectEditViewModel.insitutionalPlanRequired(""))}function ProjectEditViewModel(){var e=this;e.isEdit=ko.observable("dimmed"),e.hasError=ko.observable(!0),e.assignToUnitNotSelected=ko.observable("dimmed"),e.insitutionalPlanRequired=ko.observable("property-required"),e.institutionalPlanMandatory=ko.observable(!0),e.selectedStartDate=ko.observable(window.system.getMinDate()),e.minDate=ko.observable(),e.maxDate=ko.observable(new Date("October 15, 2120 05:35:32").toISOString().split("T")[0]),e.Id=ko.observable().extend({required:{params:!0,message:system.translateWord("requiredField")}}),e.title=ko.observable(window.system.translateWord("edit-project")),e.textBtn=ko.observable(window.system.translateWord("edit")),e.projectName=ko.observable().extend({required:{params:!0,message:system.translateWord("requiredField")},maxLength:{params:200,message:window.system.translateWord("maxLength200")},modletter:{params:!0,message:window.system.translateWord("specialCharNotAllowed")}}),e.projectManagerOptions=ko.observableArray(),e.projectManager=ko.observable().extend(),e.institutionalPlanOptions=ko.observableArray([{name:"الخطة المؤساسية",id:122}]),e.institutionalPlan=ko.observable().extend({required:{params:!0,message:system.translateWord("requiredField")}}),e.assignToUnitOptions=ko.observableArray(),e.assignToUnit=ko.observable().extend({required:{params:!0,message:system.translateWord("requiredField")}}),e.assignToUnit.subscribe(function(t){0==t.length?e.assignToUnitNotSelected("dimmed"):""==t[0]?e.assignToUnitNotSelected("dimmed"):e.assignToUnitNotSelected("")}),e.projectRelateProgOptions=ko.observableArray(),e.projectRelateProg=ko.observable().extend({required:{params:!0,message:system.translateWord("requiredField")}}),e.projectRelateProg.subscribe(function(t){if(""==t)return;let o=t[0].split(":")[2];o&&e.maxDate(o)}),e.projectEndDate=ko.observable().extend({required:{params:!0,message:system.translateWord("requiredField")},date:{params:!0,message:window.system.translateWord("requiredDate")},smallerThanDate:{params:e.maxDate,message:window.system.translateWord("smallerThanDate")}}),e.projectStartDate=ko.observable().extend({required:{params:!0,message:system.translateWord("requiredField")},date:{params:!0,message:window.system.translateWord("requiredDate")},smallerThanDate:{params:e.projectEndDate,message:window.system.translateWord("smallerThanDate")}}),e.projectDescription=ko.observable().extend({maxLength:{params:5e3,message:window.system.translateWord("maxLength4000")},modletter:{params:!0,message:window.system.translateWord("specialCharNotAllowed")}}),e.projectNotes=ko.observable().extend({maxLength:{params:5e3,message:window.system.translateWord("maxLength4000")},modletter:{params:!0,message:window.system.translateWord("specialCharNotAllowed")}}),e.userUnitId=ko.observable(),e.createdBy=ko.observable(),e.projectStatus=ko.observable(),e.projectSubmit=function(){window.system.showLoader(!0),e.userUnitId(window.user.details.UnitId),e.createdBy(window.user.details.UserEntityId),e.projectStatus(1),e.projectManager()||e.projectManager(window.user.details.UserEntityId),ProjectModel().editProject(e).done(function(t){$("#project-edit #mod-btn-project-close").click();var o=$("#project-edit").attr("project-success");o&&o.length>3?window[o]():location.reload(!0),restProject(e),window.system.showLoader(!1)}).fail(function(e){window.system.handleError(e),window.system.showLoader(!1)})},e.errors=ko.validation.group(e)}function restEditProject(e){projectEditViewModel.assignToUnitNotSelected("dimmed"),projectEditViewModel.projectName(""),projectEditViewModel.projectManager(""),projectEditViewModel.projectManagerOptions([]),projectEditViewModel.institutionalPlan(""),projectEditViewModel.institutionalPlanOptions([]),projectEditViewModel.projectRelateProg(""),projectEditViewModel.projectRelateProgOptions([]),projectEditViewModel.projectEndDate(""),projectEditViewModel.projectStartDate(""),projectEditViewModel.projectDescription(""),projectEditViewModel.projectNotes(""),projectEditViewModel.userUnitId(""),projectEditViewModel.createdBy(""),System().showLoader(!1);for(var t=document.getElementsByClassName("has-error"),o=0;o<t.length;o++)$(t[o]).removeClass("has-error")}const projectSelectorControllerViews={"project-selector":"/cordys/html5/demo/TaskManagement/pages/project/view/project-selector.html"},projectSelectorControllerStyles=[],projectSelectorControllerScripts=["/cordys/html5/demo/TaskManagement/pages/project/model/project-model.js","/cordys/html5/demo/TaskManagement/pages/task/services/task-service.js","/cordys/html5/demo/TaskManagement/pages/task/model/task-model.js"];var dependency=Dependency.getInstance();dependency.execute("projectSelectorController"),dependency.addToTrigger("projectSelectorControllerOnReady");let projectSelectorViewModel=null;function projectSelectorControllerOnload(){dependency.initializeSystemObject(["getLanguage","translatePage","extendSelectize","handleError"]),dependency.initializeDomObject(["subscribe","publish"]);let e=window.system.getLanguage();window.system.translatePage(e,"project","TaskManagement","project-selector"),window.system.extendSelectize(),projectSelectorViewModel=new ProjectSelectorViewModel,KOValidation().initializeValidation(projectSelectorViewModel),ko.applyBindings(projectSelectorViewModel,$("project-selector")[0]),window.dom.subscribe("start",function(e){let t=e.Id,o=e.targetTaskPerformerId;t||(t=window.system.getUrlVariable("taskId"),t=window.system.decrypt(t),o=e),console.log(o),TaskModel().getTaskById(t).done(function(e){(e=e["wstxns2:MOD_TM_entity_Task"]||e.MOD_TM_entity_Task).taskProjectId&&"0"!=e.taskProjectId?window.dom.publish("start-task",o):($("#project-selector").modal({show:!0}),projectSelectorViewModel.taskId=t,projectSelectorViewModel.targetTaskPerformerId=o)}).fail(function(e){window.system.handleError(e)})})}function projectSelectorControllerOnReady(){TaskService().autocompleteProjectOptions(projectSelectorViewModel.taskProjectOptions,""),$("#project-selector input").on("input",function(){TaskService().autocompleteProjectOptions(projectSelectorViewModel.taskProjectOptions,this.value)})}function ProjectSelectorViewModel(){var e=this;this.hasError=ko.observable(!0),this.taskProjectOptions=ko.observableArray([]),this.project=ko.observable().extend({required:!0}),this.projectInputCounter=0,this.taskId="",this.targetTaskPerformerId="",this.submit=function(){var t=e.project()[0].split(":")[0],o=e.project()[0].split(";")[1];TaskModel().updateTaskWithProject(e.taskId,t).done(function(t){window.dom.publish("set-project-name-to-task-data",o),window.dom.publish("start-task",e.targetTaskPerformerId)}).fail(function(e){window.system.handleError(e)}),$("#cancel-project-selector").click()}}let taskReportControllerViews={reports:"/cordys/html5/demo/TaskManagement/pages/report/views/report.html"},taskReportControllerStyles=["/cordys/html5/demo/TaskManagement/pages/report/resources/styles/style.css","/cordys/html5/demo/commons/styles/Chart.css"],taskReportControllerScripts=["/cordys/html5/demo/commons/javascripts/ui/apexcharts.js","/cordys/html5/demo/TaskManagement/pages/report/model/report-model.js"],taskReportControllerLang=["/cordys/html5/demo/TaskManagement/pages/report/resources/language-pack/report-"+window.lang+".json"];var dependency=Dependency.getInstance();dependency.addToTrigger("taskReportControllerOnReady"),dependency.execute("taskReportController");let reportViewModel=null;function taskReportControllerOnload(){dependency.initializeSystemObject(["translatePage","translateWord","handleError"]),dependency.initializeDomObject(["drawRadialBarChart","subscribe"]),window.system.translatePage("reports","reports"),reportViewModel=new ReportViewModel,ko.applyBindings(reportViewModel,document.getElementById("reports")),window.dom.subscribe("reload-report",function(){reloadReportProgress()}),window.dom.subscribe("change-report-label",function(e){reportViewModel.firstLabel(window.system.transleWord(e.firstLabel)),reportViewModel.secondLabel(window.system.transleWord(e.secondLabel)),reportViewModel.thirdLabel(window.system.transleWord(e.thirdLabel))})}function taskReportControllerOnReady(){reloadReportProgress()}function reloadReportProgress(){let e=ReportModel();reloadProgramReportGraph(),reloadProjectReportGraph(),e.getTaskProgressReport().done(function(e){if(!e.tuple[0])return void window.dom.drawRadialBarChart(0,document.getElementById("task-chart"),"#c9a869");e=e.tuple[0].old.rowset.row;let r=parseInt(e.finished);isNaN(r)&&(r=0);let o=r+parseInt(e.inProgress),t=parseInt(100*r/o);isNaN(t)&&(t=0),reportViewModel.endedThirdValue(r),reportViewModel.totalThirdValue(o),window.dom.drawRadialBarChart(t,document.getElementById("task-chart"),"#c9a869")}).fail(function(e){window.dom.drawRadialBarChart(0,document.getElementById("task-chart"),"#c9a869"),window.system.handleError(e)})}function reloadProjectReportGraph(){ReportModel().getProjectProgressReport().done(function(e){if(!e.tuple[0])return void window.dom.drawRadialBarChart(0,document.getElementById("project-chart"),"#c9a869");e=e.tuple[0].old.rowset.row;let r=parseInt(e.ended),o=r+parseInt(e.inProgress),t=parseInt(100*r/o);isNaN(t)&&(t=0),reportViewModel.endedSecondValue(r),reportViewModel.totalSecondValue(o),window.dom.drawRadialBarChart(t,document.getElementById("project-chart"),"#c9a869")}).fail(function(e){window.dom.drawRadialBarChart(0,document.getElementById("project-chart"),"#c9a869"),window.system.handleError(e)})}function reloadProgramReportGraph(){ReportModel().getProgramProgressReport().done(function(e){if(!e.tuple[0])return void window.dom.drawRadialBarChart(0,document.getElementById("program-chart"),"#c9a869");e=e.tuple[0].old.rowset.row;let r=parseInt(e.ended),o=r+parseInt(e.inProgress),t=parseInt(100*r/o);isNaN(t)&&(t=0),reportViewModel.endedFirstValue(r),reportViewModel.totalFirstValue(o),window.dom.drawRadialBarChart(t,document.getElementById("program-chart"),"#c9a869")}).fail(function(e){window.dom.drawRadialBarChart(0,document.getElementById("program-chart"),"#c9a869"),window.system.handleError(e)})}function ReportViewModel(){this.firstLabel=ko.observable(window.system.translateWord("programsInFinish")),this.secondLabel=ko.observable(window.system.translateWord("projectsInFinish")),this.thirdLabel=ko.observable(window.system.translateWord("tasksInFinish")),this.endedFirstValue=ko.observable(0),this.totalFirstValue=ko.observable(0),this.endedSecondValue=ko.observable(0),this.totalSecondValue=ko.observable(0),this.endedThirdValue=ko.observable(0),this.totalThirdValue=ko.observable(0),this.reportUrl=assetConfig.processExprience+"/"+_ConfigURL("TaskReport")}function TaskService(e){if(e){let s={},a=TaskService();for(var t=0;t<e.length;t++)s[e[t]]=a[e[t]];return s}return{fillLookupValue:function(e,t){var s=[];LookupService().getByCategory("priority").done(function(a){for(let t in a)if("object"==typeof a[t]){var r=a[t],o="ar"==e?r.ar_value:r.eng_value;s.push({id:r["MOD_SYS_entity_lookup-id"].Id,name:o})}t.taskPriorityOptions(s)})},createTask:function(e,t,s){let a=TaskModel().createTask(e);_CordysRequest().postRequest(a.url,a.message,t,null,s)},getInProgressTask:function(e,t,s,a,r,o,n,i,l){return s=s||1,a=a||window.system.getPageCount(),e=e||"taskName",t=t||"sortAsc",r=r||"",o=o||-1,n=n.split("T")[0]||new Date("October 15, 1920 05:35:32").toISOString().split("T")[0],i=i.split("T")[0]||new Date("October 15, 2120 05:35:32").toISOString().split("T")[0],l=l||-1,TaskModel().getMyInProgressTask(s,a,e,t,r,o,n,i,l)},getCompletedTask:function(e,t,s,a,r,o,n,i,l){return s=s||1,a=a||window.system.getPageCount(),e=e||"taskName",t=t||"sortAsc",r=r||"",o=o||-1,n=n.split("T")[0]||new Date("October 15, 1920 05:35:32").toISOString().split("T")[0],i=i.split("T")[0]||new Date("October 15, 2120 05:35:32").toISOString().split("T")[0],l=l||-1,TaskModel().getCompletedTask(s,a,e,t,r,o,n,i,l)},getMyOwnedTask:function(e,t,s,a,r,o,n,i){return s=s||1,a=a||window.system.getPageCount(),e=e||"taskName",t=t||"sortAsc",r=r||"",o=o||-1,n=n.split("T")[0]||new Date("October 15, 1920 05:35:32").toISOString().split("T")[0],i=i.split("T")[0]||new Date("October 15, 2120 05:35:32").toISOString().split("T")[0],TaskModel().getMyOwnedTask(s,a,e,t,r,o,n,i)},getCreatedByTask:function(e,t,s,a,r,o,n,i,l){return s=s||1,a=a||window.system.getPageCount(),e=e||"taskName",t=t||"sortAsc",r=r||"",o=o||-1,n=n.split("T")[0]||new Date("October 15, 1920 05:35:32").toISOString().split("T")[0],i=i.split("T")[0]||new Date("October 15, 2120 05:35:32").toISOString().split("T")[0],l=l||-1,TaskModel().getCreatedByTask(s,a,e,t,r,o,n,i,l)},getDraftTask:function(e,t,s,a,r,o,n,i,l){return s=s||1,a=a||window.system.getPageCount(),e=e||"taskName",t=t||"sortAsc",r=r||"",o=o||-1,n=n.split("T")[0]||new Date("October 15, 1920 05:35:32").toISOString().split("T")[0],i=i.split("T")[0]||new Date("October 15, 2120 05:35:32").toISOString().split("T")[0],l=l||-1,TaskModel().getDraftTask(s,a,e,t,r,o,n,i,l)},autocompleteProjectOptions:function(e,t,s,a){e([]);s=s||1,a=a||assetConfig.autocompleteSize,t=t||"",ProjectModel().getProjectByHeadUnit(t,1,s,a).done(function(t){if(!t.tuple[0])return;var s=t.tuple[0].old.rowset.row;let a=[];if(s instanceof Array)for(let e=0;e<s.length;e++)a.push({id:s[e].Id+":"+s[e].endDate+";"+s[e].name,name:s[e].name});else a.push({id:s.Id+":"+s.endDate+";"+s.name,name:s.name});e(a)}).fail(function(e){System().handleError(e),console.log(e.responseJSON.faultstring.text)})},autocompleteTaskTeamOptions:function(e,t,s,a){s=s||1,a=a||assetConfig.autocompleteSize,userId=window.user.details.UserEntityId,TaskModel().getSubUsersRolesAndUnits(userId,t,s,a).done(function(t){if(!t.tuple[0])return;let s=window.user.details.UserEntityId;var a=t.tuple[0].old.rowset.row;let r=[];if(a instanceof Array)for(let e=0;e<a.length;e++){let t=a[e].type;t="User"==t?0:"Role"==t?1:2,s==a[e].Id&&"User"==t||r.push({id:a[e].Id+":"+t+":"+a[e].DisplayName,name:a[e].DisplayName})}else{let e=a.type;e="User"==e?0:"Role"==e?1:2,s==a.Id&&"User"==e||r.push({id:a.Id+":"+e+":"+a.DisplayName,name:a.DisplayName})}for(var o=e.taskTeam(),n=0;n<(void 0!==o)&&o.length;n++){var i=o[n],l=i.split(":");r.push({id:i,name:l[2]})}e.taskTeamOptions(r),e.taskTeam(o)})},viewTask:function(e){Cordys().getTaskId();var t=assetConfig.processExprience+"/"+_ConfigURL("taskDisplay")+"?taskId="+e;if(window.cntrlIsPressed){var s=window.open(t,"_blank");s.focus()}else window.top.location=t},showEdit:function(e,t){TaskModel().getTaskDataById(e,window.user.details.UserEntityId).done(function(e){e.tuple[0]&&(e=e.tuple[0].old.rowset.row,t(e))}).fail(function(e){system.handleError(e),console.log(e.responseJSON.faultstring.text)})},editTask:function(e,t,s){let a=TaskModel().editTask(e);_CordysRequest().postRequest(a.url,a.message,t,null,s)},addAttributesToTaskResponse:function(e,t){console.log(e),e.priority||(e.priority=3);e.priorityClass=System().convertClassPriority(parseInt(e.priority)),e.finished=parseInt(e.finished),isNaN(e.finished)?e.isFinished=!1:e.finished?e.isFinished=!0:e.isFinished=!1;e.taskStatus=parseInt(e.taskStatus),e.isOwner=!1;let s=window.user.details.UserEntityId;s!=e.ownerId&&s!=e.createdById||(e.isOwner=!0);e.canDelete=ko.observable(!1),e.canClose=ko.observable(!1),e.canEdit=ko.observable(!1),e.canAcquireTask=ko.observable(!1),e.canStartTask=ko.observable(!1),e.canEndTask=ko.observable(!1),e.canRestartTask=ko.observable(!1),e.canArchive=ko.observable(!1),e.canForceClose=ko.observable(!1),e.progressColor=ko.observable("progress-bar"),e.canReturnTask=ko.observable(!1),e.targetTaskPerformerId=e.targetTaskPerformerId?parseInt(e.targetTaskPerformerId):0;let a=parseInt(e.progress),r=System().getDifferenceBetweenTwoDatesWithoutABS(new Date(e.startDate),new Date(e.dueDate)),o=System().getDifferenceBetweenTwoDatesWithoutABS(new Date(e.startDate),new Date)/r*100;100==a?e.progressColor="progress-bar":a<o+10&&a>o-10?e.progressColor="progress-bar-gold":a>o?e.progressColor="progress-bar":a<o&&(e.progressColor="progress-bar-red");e.isOwner?(1!=e.taskStatus&&2!=e.taskStatus&&10!=e.taskStatus||e.canEdit(!0),1!=e.taskStatus&&2!=e.taskStatus||e.canForceClose(!0),1!=e.taskStatus&&10!=e.taskStatus||s!=e.createdById?2==e.taskStatus&&e.isFinished?(e.canClose(!0),e.canForceClose(!1)):3==e.taskStatus&&e.canArchive(!0):e.canDelete(!0)):(e.targetTaskPerformerStatus=parseInt(e.targetTaskPerformerStatus),e.singleOrMultiple="false"!=e.singleOrMultiple,1==e.taskStatus?0==e.targetTaskPerformerStatus&&e.singleOrMultiple?e.canStartTask(!0):0!=e.targetTaskPerformerStatus||e.singleOrMultiple||(e.canAcquireTask(!0),e.canReturnTask(!0)):2==e.taskStatus&&(1==e.targetTaskPerformerStatus?e.canRestartTask(!0):0==e.targetTaskPerformerStatus&&e.singleOrMultiple?e.canStartTask(!0):0!=e.targetTaskPerformerStatus||e.singleOrMultiple||e.canReturnTask(!0),100==parseInt(e.progress)&&e.canEndTask(!0)));if(e.taskUrl=assetConfig.processExprience+"/"+_ConfigURL("taskDisplay")+"?taskId="+window.system.encrypt(e.Id),e.startDate=e.startDate.split("T")[0],e.dueDate=e.dueDate.split("T")[0],1==e.taskStatus||2==e.taskStatus){let t=new Date,s=new Date(e.dueDate);s<t&&(e.dueDateClass="due-date-class")}e.dueDateClass||(e.dueDateClass="");return e.taskStatus=function(e,t,s){switch(e){case 0:return window.system.translateWord("stopped");case 1:return window.system.translateWord("not-start");case 2:return"completedTask"==s?window.system.translateWord("ended"):t?window.system.translateWord("task-can-closed"):window.system.translateWord("inprogress");case 3:return window.system.translateWord("ended");case 10:return window.system.translateWord("draft");case 11:return system.translateWord("obselate");case 12:return system.translateWord("archived");default:return e}}(e.taskStatus,e.isFinished,t),e.taskPerformers=ko.observableArray([]),e.progress=e.progress+"%",e},openTaskCollapse:function(e,t,s){TaskModel().getListOfWorkingUser(e,1,3).done(function(e){let a=[],r=0;for(var o in e)"object"!=typeof e[o]||o.indexOf(":Cursor")>-1||(r<3&&a.push({performerName:e[o].displayName,className:""}),r++);r>3&&(r-=3,a.push({performerName:r,className:"user-record-gold"})),s(a),$(t).parent().toggleClass("open").next(".fold").toggleClass("open");let n=$(t).parent().next(".fold")[0],i=n.getElementsByClassName("extra-task-data")[0],l=$(i).attr("data-value");if(l&&0==l.indexOf("post-")){let e=i.getElementsByTagName("label")[0];e.innerHTML=System().translateWord("point-of-discussion");let t=i.getElementsByTagName("div")[0];t.innerHTML=l.substring(5,l.length)}}).fail(function(e){System().handleError(e)})}}}function ProjectService(){return{createProject:function(e){return ProjectModel().createProject(e)},getProjectRelateProgOptions:n,autoCompleteProjectRelateProg:function(e,t){n(t,e)},assignToUnit:t,autoCompleteAssignToUnit:function(e,n){t(n,e)},autoCompleteProjectOwner:function(e,t,n,o,r){o=o||1,r=r||window.system.getAutoCompleteCount(),userId=window.user.details.UserEntityId,e=e||"";let i=-1;t.assignToUnit()&&t.assignToUnit().length>0&&-1!=(i=t.assignToUnit()[0]).indexOf(":")&&(i=i.split(":")[1]);SharedModel().getUserUnderUnitsByUnitCodes("MSM,USM,AAM,EXM,DIV,DIR,OFC",i,e).done(function(e){if(!e.tuple[0])return;var o=e.tuple[0].old.rowset.row;let r=[];if(o instanceof Array)for(let e=0;e<o.length;e++)r.push({id:o[e].UserEntityId,name:o[e].DisplayName});else r.push({id:o.UserEntityId,name:o.DisplayName});n?function(e){e.push({id:window.user.details.UserEntityId,name:window.user.details.DisplayName}),projectCreateViewModel.projectManagerOptions(e),projectCreateViewModel.projectManager([window.user.details.UserEntityId])}(r):t.projectManagerOptions(r)}).fail(function(e){System().handleError(e),console.log(e.responseJSON.faultstring.text)})},drawProjectObj:function(t,n){var o=window.user.details.UserEntityId;let r=System();t=t||1,ProjectModel().countProject(o,"countProject",t).done(function(o){r.showLoader(!1);var i=Math.ceil(o.count.text/r.getPageCount());0!=i&&(Dom().drawPagination(n.getElementsByClassName("pagination")[0],i,fillMyInProgressTaskTable),e(n,t))}).fail(function(e){r.handleError(e),r.showLoader(!1),console.log(e.responseJSON.faultstring.text)})},fillProjectTable:e};function e(e,t,n,o,r){t=t||1,n=n||1;o=o||"projectName",r=r||"sortAsc";var i=window.user.details.UserEntityId,s=System();ProjectModel().getProjectByStatus(i,t,n,10,o,r).done(function(n){(e=e.getElementsByClassName("project-data-table")[0]).innerHTML="",function(e,t,n){if(e.innerHTML="",t.tuple[0]){var o=t.tuple[0].old.rowset.row;if(o instanceof Array)for(let t=0;t<o.length;t++)e.innerHTML+=drawProject(o[t],t,n);else e.innerHTML=drawProject(o,0,n)}else System().showLoader(!1)}(e,n,t),s.showLoader(!1)}).fail(function(e){s.handleError(e),console.log(e.responseJSON.faultstring.text),s.showLoader(!1)})}function t(e,t,n,o){t=t||"",n=n||1,o=o||window.system.getAutoCompleteCount(),ProjectModel().getUnitsByUnitTypeCode("DIR,OFC,DIV",t,n,o).done(function(t){if(!t.tuple[0])return;var n=t.tuple[0].old.rowset.row;let o=[];if(n instanceof Array)for(let e=0;e<n.length;e++)o.push({id:n[e].UnitId+":"+n[e].UnitPathById,name:n[e].UnitName});else o.push({id:n.UnitId+":"+n.UnitPathById,name:n.UnitName});e.assignToUnitOptions(o)}).fail(function(e){System().handleError(e),console.log(e.responseJSON.faultstring.text)})}function n(e,t,n,o,r){o=o||1,r=r||5,t=t||"",n=n||1;let i=window.user.details.UnitId+"/";ProgramModel().getProgramByPathAndStatus(i,t,n,o,r).done(function(t){if(!t.tuple[0])return;var n=t.tuple[0].old.rowset.row;let o=[];if(n instanceof Array)for(let e=0;e<n.length;e++){let t=n[e].startDate?n[e].startDate.split("T")[0]:"",r=n[e].endDate?n[e].endDate.split("T")[0]:"";o.push({id:n[e].Id+":"+t+":"+r,name:n[e].name})}else{let e=n.startDate?n.startDate.split("T")[0]:"",t=n.endDate?n.endDate.split("T")[0]:"";o.push({id:n.Id+":"+e+":"+t,name:n.name})}e.projectRelateProgOptions(o)}).fail(function(e){System().handleError(e),console.log(e.responseJSON.faultstring.text)})}}